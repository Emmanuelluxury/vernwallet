<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bitcoin-Starknet Bridge Dashboard</title>
    <link rel="icon" href="../images/image.png" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #7c3aed;
            --primary-dark: #6d28d9;
            --primary-light: rgba(124, 58, 237, 0.15);
            --secondary: #10b981;
            --secondary-dark: #059669;
            --dark: #0f172a;
            --darker: #0a0f1c;
            --light: #f9fafb;
            --lighter: #ffffff;
            --gray: #94a3b8;
            --gray-light: rgba(148, 163, 184, 0.2);
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
            --bitcoin-orange: #f7931a;
            --starknet-purple: #8a2be2;
            --border-radius: 12px;
            --card-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            --transition: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, var(--darker) 0%, #0c1424 100%);
            color: var(--light);
            line-height: 1.6;
            min-height: 100vh;
            padding: 0;
            margin: 0;
            overflow-x: hidden;
        }
        
        .app-container {
            display: flex;
            min-height: 100vh;
        }
        
        /* Sidebar Navigation */
        .sidebar {
            width: 280px;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(15px);
            border-right: 1px solid rgba(255, 255, 255, 0.05);
            padding: 25px 0;
            display: flex;
            flex-direction: column;
            position: sticky;
            top: 0;
            height: 100vh;
            z-index: 100;
            transition: var(--transition);
        }
        
        .sidebar-header {
            padding: 0 25px 25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            margin-bottom: 25px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 800;
            font-size: 1.4rem;
            color: white;
            text-decoration: none;
            transition: var(--transition);
        }
        
        .logo:hover {
            transform: translateY(-1px);
        }
        
        .logo-icon {
            color: var(--primary);
            font-size: 2rem;
            background: var(--primary-light);
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 14px 25px;
            color: var(--gray);
            text-decoration: none;
            transition: var(--transition);
            border-left: 4px solid transparent;
            margin: 4px 12px;
            border-radius: 8px 0 0 8px;
        }
        
        .nav-item:hover, .nav-item.active {
            background: var(--primary-light);
            color: var(--lighter);
            border-left-color: var(--primary);
        }
        
        .nav-item i {
            width: 20px;
            text-align: center;
            font-size: 1.1rem;
        }
        
        /* User Profile Section */
        .user-profile {
            padding: 20px;
            margin-top: auto;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 1.2rem;
            position: relative;
            overflow: hidden;
            cursor: pointer;
            border: 2px solid rgba(255, 255, 255, 0.1);
            transition: var(--transition);
        }

        .user-avatar:hover {
            border-color: var(--primary);
            transform: scale(1.05);
        }

        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
        }

        /* Ensure initials are behind images */
        .user-avatar #avatarInitials {
            position: relative;
            z-index: 0;
        }

        .avatar-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
            opacity: 0;
            transition: opacity 0.3s ease;
            border-radius: 50%;
        }

        .user-avatar:hover .avatar-overlay {
            opacity: 1;
        }

        .avatar-overlay i {
            transform: scale(0.8);
            transition: transform 0.3s ease;
        }

        .user-avatar:hover .avatar-overlay i {
            transform: scale(1);
        }
        
        .user-info {
            flex: 1;
        }
        
        .user-name {
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .user-role {
            font-size: 0.8rem;
            color: var(--gray);
        }

        /* Enhanced User Profile Styles */
        .user-address {
            font-size: 0.7rem;
            color: var(--gray);
            margin-top: 2px;
            font-family: monospace;
            max-width: 120px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .connection-indicator {
            position: absolute;
            bottom: -2px;
            right: -2px;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: var(--danger);
            border: 2px solid var(--darker);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 8px;
            color: white;
        }

        .connection-indicator.connected {
            background: var(--secondary);
        }

        .connection-indicator.connecting {
            background: var(--warning);
        }

        .profile-actions {
            position: relative;
        }

        .profile-menu-btn {
            background: none;
            border: none;
            color: var(--gray);
            font-size: 1.2rem;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: var(--transition);
        }

        .profile-menu-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--primary);
        }

        .profile-menu {
            position: absolute;
            bottom: 100%;
            right: 0;
            background: var(--darker);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            min-width: 200px;
            z-index: 1000;
            margin-bottom: 10px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(10px);
            transition: var(--transition);
        }

        .profile-menu.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .profile-menu-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            color: var(--light);
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
        }

        .profile-menu-item:hover {
            background: rgba(124, 58, 237, 0.1);
            color: var(--primary);
        }

        .profile-menu-item i {
            width: 16px;
            color: var(--gray);
        }

        .profile-menu-item:hover i {
            color: var(--primary);
        }

        .profile-menu-divider {
            height: 1px;
            background: rgba(255, 255, 255, 0.1);
            margin: 8px 0;
        }

        /* Picture Selection Styles */
        .picture-selection-area {
            margin-top: 10px;
        }

        .picture-selector {
            cursor: pointer;
            padding: 8px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.1);
            transition: var(--transition);
        }

        .picture-selector:hover {
            background: rgba(124, 58, 237, 0.1);
            border-color: var(--primary);
        }

        .picture-preview-grid {
            max-height: 200px;
            overflow-y: auto;
        }

        .avatar-option {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary-light);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
        }

        .avatar-option:hover {
            border-color: var(--primary);
            transform: scale(1.1);
        }

        .avatar-option.selected {
            border-color: var(--secondary);
            background: var(--secondary);
        }

        .avatar-option img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .picture-selector-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .picture-selector-title {
            color: var(--light);
            font-size: 0.8rem;
            font-weight: 600;
        }

        .picture-selector-close {
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            font-size: 1rem;
            padding: 2px;
            border-radius: 50%;
            transition: var(--transition);
        }

        .picture-selector-close:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--light);
        }

        /* File Upload Styles */
        .file-upload-area {
            border: 2px dashed rgba(255,255,255,0.2);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .file-upload-area:hover {
            border-color: var(--primary);
            background: rgba(124, 58, 237, 0.05);
        }

        .file-upload-area.dragover {
            border-color: var(--secondary);
            background: rgba(16, 185, 129, 0.1);
        }

        .image-preview-area {
            text-align: center;
        }

        .image-preview {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 2px solid var(--primary);
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255,255,255,0.1);
            margin: 0 auto;
        }

        .image-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .image-preview-actions {
            margin-top: 10px;
            display: flex;
            gap: 8px;
            justify-content: center;
        }

        .image-preview-actions button {
            padding: 6px 12px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-size: 0.8rem;
            transition: var(--transition);
        }

        .image-preview-actions button:first-child {
            background: var(--primary);
            color: white;
        }

        .image-preview-actions button:first-child:hover {
            background: var(--primary-dark);
        }

        .image-preview-actions button:last-child {
            background: rgba(255,255,255,0.1);
            color: white;
        }

        .image-preview-actions button:last-child:hover {
            background: rgba(255,255,255,0.2);
        }

        /* Enhanced Avatar Upload Styles */
        .avatar-upload-container {
            position: relative;
            display: inline-block;
        }

        .avatar-upload-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
            cursor: pointer;
            z-index: 5;
        }

        .user-avatar:hover .avatar-upload-overlay {
            opacity: 1;
        }

        .avatar-upload-text {
            color: white;
            font-size: 0.8rem;
            text-align: center;
            font-weight: 500;
        }

        .avatar-upload-icon {
            font-size: 1.5rem;
            margin-bottom: 5px;
            color: var(--primary);
        }

        .avatar-loading-ring {
            position: absolute;
            top: -2px;
            left: -2px;
            width: calc(100% + 4px);
            height: calc(100% + 4px);
            border-radius: 50%;
            border: 2px solid transparent;
            border-top: 2px solid var(--primary);
            animation: avatar-spin 1s linear infinite;
            z-index: 6;
        }

        @keyframes avatar-spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .avatar-error-state {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(239, 68, 68, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--danger);
            font-size: 1.2rem;
            z-index: 2;
        }

        .avatar-success-state {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(16, 185, 129, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--secondary);
            font-size: 1.2rem;
            z-index: 2;
            animation: success-pulse 0.6s ease;
        }

        @keyframes success-pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* Enhanced file input styling */
        .avatar-file-input {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            cursor: pointer;
            z-index: 10;
        }

        /* Drag and drop visual feedback */
        .avatar-drag-over {
            border: 3px solid var(--primary) !important;
            background: rgba(124, 58, 237, 0.1) !important;
            transform: scale(1.05);
        }

        .avatar-drag-feedback {
            position: absolute;
            top: -40px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--darker);
            color: var(--light);
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.8rem;
            white-space: nowrap;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .avatar-drag-feedback.show {
            opacity: 1;
            visibility: visible;
        }

        .avatar-drag-feedback::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 5px solid transparent;
            border-top-color: var(--darker);
        }

        /* Image preview modal styles */
        .image-preview-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .image-preview-modal.show {
            opacity: 1;
            visibility: visible;
        }

        .image-preview-modal-content {
            background: var(--darker);
            padding: 30px;
            border-radius: 16px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            position: relative;
        }

        .image-preview-modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: var(--gray);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: var(--transition);
        }

        .image-preview-modal-close:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--light);
        }

        .image-preview-large {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--primary);
            margin: 0 auto 20px;
            display: block;
        }

        .image-preview-actions-modal {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        .image-preview-actions-modal button {
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: var(--transition);
        }

        .image-preview-actions-modal button:first-child {
            background: var(--primary);
            color: white;
        }

        .image-preview-actions-modal button:first-child:hover {
            background: var(--primary-dark);
        }

        .image-preview-actions-modal button:last-child {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .image-preview-actions-modal button:last-child:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* Progress indicator for avatar upload */
        .avatar-progress-container {
            position: absolute;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            height: 3px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            overflow: hidden;
            z-index: 3;
        }

        .avatar-progress-bar {
            height: 100%;
            background: var(--primary);
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 2px;
        }

        /* Enhanced avatar menu styles */
        .avatar-menu {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--darker);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            min-width: 220px;
            z-index: 1000;
            margin-bottom: 10px;
            opacity: 0;
            visibility: hidden;
            transform: translateX(-50%) translateY(10px);
            transition: var(--transition);
            backdrop-filter: blur(10px);
        }

        .avatar-menu.show {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(0);
        }

        .avatar-menu-header {
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-weight: 600;
            color: var(--primary);
            font-size: 0.9rem;
        }

        .avatar-menu-section {
            padding: 8px 0;
        }

        .avatar-menu-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 15px;
            color: var(--light);
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
            position: relative;
        }

        .avatar-menu-item:hover {
            background: rgba(124, 58, 237, 0.1);
            color: var(--primary);
            padding-left: 20px;
        }

        .avatar-menu-item i {
            width: 16px;
            color: var(--gray);
            transition: var(--transition);
        }

        .avatar-menu-item:hover i {
            color: var(--primary);
        }

        .avatar-menu-item.danger {
            color: var(--danger);
        }

        .avatar-menu-item.danger:hover {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
        }

        .avatar-menu-item.danger:hover i {
            color: var(--danger);
        }

        .avatar-menu-divider {
            height: 1px;
            background: rgba(255, 255, 255, 0.1);
            margin: 8px 0;
        }

        /* Keyboard shortcut hints */
        .avatar-menu-item .shortcut {
            margin-left: auto;
            font-size: 0.7rem;
            color: var(--gray);
            background: rgba(255, 255, 255, 0.1);
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
        }

        .avatar-menu-item:hover .shortcut {
            color: var(--primary);
            background: rgba(124, 58, 237, 0.2);
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            background: rgba(15, 23, 42, 0.3);
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 16px 0;
        }
        
        .header-title {
            font-size: 2.2rem;
            font-weight: 800;
            background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            position: relative;
            display: inline-block;
        }
        
        .header-title::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 0;
            width: 60px;
            height: 3px;
            background: var(--primary);
            border-radius: 3px;
        }
        
        .header-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .notification-bell {
            position: relative;
            cursor: pointer;
            padding: 10px;
            border-radius: 8px;
            transition: var(--transition);
        }

        .notification-bell:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .notification-badge {
            position: absolute;
            top: 5px;
            right: 5px;
            background: var(--danger);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        .notification-panel {
            position: absolute;
            top: 60px;
            right: 0;
            width: 350px;
            background: var(--darker);
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: none;
            z-index: 1000;
            max-height: 400px;
            overflow-y: auto;
        }

        .notification-header {
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .notification-item {
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            cursor: pointer;
            transition: var(--transition);
        }

        .notification-item:hover {
            background: rgba(255, 255, 255, 0.03);
        }

        .notification-item.unread {
            background: rgba(124, 58, 237, 0.1);
            border-left: 3px solid var(--primary);
        }

        .notification-title {
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .notification-message {
            font-size: 0.8rem;
            color: var(--gray);
            margin-bottom: 5px;
        }

        .notification-time {
            font-size: 0.7rem;
            color: var(--gray-light);
        }
        
        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 12px 20px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(124, 58, 237, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        /* Enhanced Refresh Button Styles */
        .btn.refresh-btn {
            position: relative;
            overflow: hidden;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
        }

        .btn.refresh-btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn.refresh-btn:active::after {
            width: 300px;
            height: 300px;
        }

        .btn.refresh-btn.loading {
            background: linear-gradient(135deg, var(--warning), #f59e0b);
            cursor: not-allowed;
        }

        .btn.refresh-btn.loading i {
            animation: spin 1s linear infinite;
        }

        .btn.refresh-btn.success {
            background: linear-gradient(135deg, var(--secondary), var(--secondary-dark));
            animation: successPulse 0.6s ease;
        }

        .btn.refresh-btn.error {
            background: linear-gradient(135deg, var(--danger), #dc2626);
            animation: errorShake 0.6s ease;
        }

        .btn.refresh-btn i {
            transition: transform 0.3s ease;
        }

        .btn.refresh-btn:hover i {
            transform: rotate(180deg);
        }

        .btn.refresh-btn.loading:hover i {
            transform: none;
        }

        /* Progress indicator for refresh */
        .refresh-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 3px;
            background: var(--primary);
            border-radius: 0 0 10px 10px;
            transition: width 0.3s ease;
            width: 0%;
        }

        .btn.refresh-btn.loading .refresh-progress {
            background: var(--warning);
        }

        .btn.refresh-btn.success .refresh-progress {
            background: var(--secondary);
        }

        .btn.refresh-btn.error .refresh-progress {
            background: var(--danger);
        }

        /* Refresh button states */
        .refresh-states {
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--darker);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.8rem;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
            z-index: 1000;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .btn.refresh-btn:hover .refresh-states {
            opacity: 1;
            visibility: visible;
        }

        .refresh-states::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 5px solid transparent;
            border-top-color: var(--darker);
        }

        /* Refresh notification styles */
        .refresh-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--darker);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            border-left: 4px solid var(--primary);
            z-index: 1001;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            max-width: 300px;
        }

        .refresh-notification.show {
            transform: translateX(0);
        }

        .refresh-notification.success {
            border-left-color: var(--secondary);
        }

        .refresh-notification.error {
            border-left-color: var(--danger);
        }

        .refresh-notification-content {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .refresh-notification-icon {
            font-size: 1.2rem;
        }

        .refresh-notification.success .refresh-notification-icon {
            color: var(--secondary);
        }

        .refresh-notification.error .refresh-notification-icon {
            color: var(--danger);
        }

        /* Refresh animations */
        @keyframes successPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes errorShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Refresh button glow effect */
        .btn.refresh-btn {
            box-shadow: 0 4px 15px rgba(124, 58, 237, 0.3);
        }

        .btn.refresh-btn:hover {
            box-shadow: 0 6px 20px rgba(124, 58, 237, 0.4);
        }

        .btn.refresh-btn.loading {
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
        }

        .btn.refresh-btn.success {
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
        }

        .btn.refresh-btn.error {
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.4);
        }
        
        .btn-sm {
            padding: 8px 15px;
            font-size: 0.8rem;
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.08);
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }
        
        .stat-card {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(10px);
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--card-shadow);
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), transparent);
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .stat-title {
            font-size: 0.95rem;
            color: var(--gray);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.4rem;
        }
        
        .bitcoin-icon {
            background: rgba(247, 147, 26, 0.2);
            color: var(--bitcoin-orange);
        }
        
        .starknet-icon {
            background: rgba(138, 43, 226, 0.2);
            color: var(--starknet-purple);
        }
        
        .proof-icon {
            background: rgba(16, 185, 129, 0.2);
            color: var(--secondary);
        }
        
        .operator-icon {
            background: rgba(59, 130, 246, 0.2);
            color: var(--info);
        }
        
        .stat-value {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 8px;
            background: linear-gradient(90deg, var(--lighter) 0%, var(--gray) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .stat-change {
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 6px;
            font-weight: 500;
        }
        
        .positive {
            color: var(--secondary);
        }
        
        .negative {
            color: var(--danger);
        }
        
        /* Cards */
        .card {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(10px);
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--card-shadow);
            border: 1px solid rgba(255, 255, 255, 0.05);
            margin-bottom: 25px;
            transition: var(--transition);
        }
        
        .card:hover {
            border-color: rgba(255, 255, 255, 0.1);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        }
        
        .card-title {
            font-size: 1.3rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .card-title i {
            color: var(--primary);
            background: var(--primary-light);
            width: 36px;
            height: 36px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .card-actions {
            display: flex;
            gap: 10px;
        }
        
        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 25px;
        }
        
        @media (max-width: 1200px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* Progress Bars */
        .progress-container {
            margin: 18px 0;
        }
        
        .progress-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .progress-label {
            font-size: 0.9rem;
            color: white;
        }
        
        .progress-value {
            font-size: 0.9rem;
            font-weight: 600;
        }
        
        .progress-bar {
            height: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            overflow: hidden;
            position: relative;
        }
        
        .progress-fill {
            height: 100%;
            border-radius: 5px;
            position: relative;
            overflow: hidden;
        }
        
        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background-image: linear-gradient(
                -45deg, 
                rgba(255, 255, 255, 0.2) 25%, 
                transparent 25%, 
                transparent 50%, 
                rgba(255, 255, 255, 0.2) 50%, 
                rgba(255, 255, 255, 0.2) 75%, 
                transparent 75%, 
                transparent
            );
            z-index: 1;
            background-size: 20px 20px;
            animation: move 1s linear infinite;
            border-top-right-radius: 8px;
            border-bottom-right-radius: 8px;
        }
        
        /* Tables */
        .table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }
        
        .table th {
            text-align: left;
            padding: 16px;
            font-size: 0.95rem;
            color: var(--gray);
            font-weight: 600;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(0, 0, 0, 0.2);
        }
        
        .table th:first-child {
            border-top-left-radius: 8px;
        }
        
        .table th:last-child {
            border-top-right-radius: 8px;
        }
        
        .table td {
            padding: 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            transition: var(--transition);
        }
        
        .table tr:last-child td {
            border-bottom: none;
        }
        
        .table tr:hover td {
            background: rgba(124, 58, 237, 0.05);
        }
        
        /* Status badges */
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .status-pending {
            background: rgba(245, 158, 11, 0.15);
            color: var(--warning);
        }
        
        .status-completed {
            background: rgba(16, 185, 129, 0.15);
            color: var(--secondary);
        }
        
        .status-failed {
            background: rgba(239, 68, 68, 0.15);
            color: var(--danger);
        }
        
        .status-processing {
            background: rgba(59, 130, 246, 0.15);
            color: var(--info);
        }
        
        /* Operator List */
        .operator-list {
            list-style: none;
        }
        
        .operator-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            cursor: pointer;
            transition: var(--transition);
            border-radius: 8px;
        }

        .operator-item:hover {
            background: rgba(124, 58, 237, 0.08);
            transform: translateX(5px);
        }
        
        .operator-item:last-child {
            border-bottom: none;
        }
        
        .operator-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: rgba(124, 58, 237, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            font-size: 1.1rem;
        }
        
        .operator-details {
            flex: 1;
        }
        
        .operator-name {
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .operator-meta {
            font-size: 0.8rem;
            color: var(--gray);
        }
        
        .operator-status {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        .status-online {
            background: var(--secondary);
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.2);
        }
        
        .status-offline {
            background: var(--danger);
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.2);
        }
        
        .status-syncing {
            background: var(--warning);
            box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.2);
        }
        
        /* Alerts */
        .alert {
            padding: 18px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            display: flex;
            align-items: flex-start;
            gap: 14px;
            background: rgba(30, 41, 59, 0.6);
            border-left: 4px solid;
        }
        
        .alert-info {
            border-left-color: var(--info);
            background: rgba(59, 130, 246, 0.1);
        }
        
        .alert-warning {
            border-left-color: var(--warning);
            background: rgba(245, 158, 11, 0.1);
        }
        
        .alert-icon {
            font-size: 1.4rem;
            margin-top: 2px;
        }
        
        .alert-info .alert-icon {
            color: var(--info);
        }
        
        .alert-warning .alert-icon {
            color: var(--warning);
        }
        
        .alert-content {
            flex: 1;
        }
        
        .alert-title {
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 1.05rem;
        }
        
        .alert-description {
            font-size: 0.95rem;
            color: var(--gray);
            line-height: 1.5;
        }
        
        /* Filter Bar */
        .filter-bar {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            align-items: center;
        }
        
        .filter-select {
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: white;
            font-size: 0.9rem;
            cursor: pointer;
        }
        
        /* API Endpoints */
        .endpoint {
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .endpoint-method {
            display: inline-block;
            padding: 5px 10px;
            background: var(--primary);
            color: white;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-right: 10px;
        }
        
        .endpoint-path {
            font-family: monospace;
            font-size: 0.9rem;
        }
        
        .endpoint-description {
            margin-top: 10px;
            font-size: 0.9rem;
            color: var(--gray);
        }
        
        .code-block {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            font-family: monospace;
            font-size: 0.9rem;
            overflow-x: auto;
            margin: 15px 0;
        }

        .api-response {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 15px;
            font-family: monospace;
            font-size: 0.9rem;
            border-left: 4px solid var(--secondary);
        }

        .api-response.success {
            border-left-color: var(--secondary);
        }

        .api-response.error {
            border-left-color: var(--danger);
        }

        .response-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            font-family: 'Inter', sans-serif;
            font-size: 0.9rem;
        }

        /* New: Recent Activity Timeline */
        .timeline {
            position: relative;
            padding-left: 30px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: rgba(255, 255, 255, 0.1);
        }

        .timeline-item {
            position: relative;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(30, 41, 59, 0.3);
            border-radius: 8px;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -25px;
            top: 20px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--primary);
        }

        .timeline-time {
            font-size: 0.8rem;
            color: var(--gray);
            margin-bottom: 5px;
        }

        .timeline-content {
            font-size: 0.9rem;
        }

        /* Mobile Navigation */
        .mobile-nav {
            position: fixed;
            top: 0;
            left: -100%;
            width: 280px;
            height: 100vh;
            background: var(--darker);
            backdrop-filter: blur(10px);
            border-right: 1px solid rgba(255, 255, 255, 0.05);
            z-index: 1000;
            transition: left 0.3s ease;
            box-shadow: 5px 0 25px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
        }

        .mobile-nav.active {
            left: 0;
        }

        .mobile-nav-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .mobile-nav-logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 800;
            font-size: 1.2rem;
            color: white;
        }

        .mobile-nav-close {
            background: none;
            border: none;
            color: var(--gray);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: var(--transition);
        }

        .mobile-nav-close:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .mobile-nav-links {
            list-style: none;
            padding: 0;
            margin: 0;
            flex: 1;
        }

        .mobile-nav-item {
            margin: 0;
        }

        .mobile-nav-link {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px 20px;
            color: var(--gray);
            text-decoration: none;
            transition: var(--transition);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .mobile-nav-link:hover {
            background: rgba(124, 58, 237, 0.1);
            color: white;
            padding-left: 25px;
        }

        .mobile-nav-item.active .mobile-nav-link {
            background: rgba(124, 58, 237, 0.1);
            color: white;
            border-left: 4px solid var(--primary);
        }

        .mobile-nav-link i {
            width: 20px;
            text-align: center;
            font-size: 1.1rem;
        }

        /* New: Network Status Panel */
        .network-status {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(30, 41, 59, 0.6);
            border-radius: var(--border-radius);
            padding: 15px 20px;
            margin-bottom: 25px;
        }

        .network-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .network-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .network-online {
            background: var(--secondary);
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.2);
        }

        .network-offline {
            background: var(--danger);
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.2);
        }

        .network-name {
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .network-item {
            position: relative;
        }

        .network-item:hover .network-name {
            color: var(--primary);
        }

        .network-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--darker);
            color: var(--light);
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 0.85rem;
            white-space: nowrap;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
            margin-bottom: 8px;
        }

        .network-item:hover .network-tooltip {
            opacity: 1;
            visibility: visible;
        }

        .network-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 5px solid transparent;
            border-top-color: var(--darker);
        }

        .network-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 8px;
        }

        .network-stat {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .network-stat-value {
            font-weight: 600;
            color: var(--secondary);
        }

        .network-stat-label {
            font-size: 0.75rem;
            color: var(--gray);
        }

        .network-pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(16, 185, 129, 0); }
            100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); }
        }

        .network-checking {
            animation: checking 1.5s infinite;
        }

        @keyframes checking {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .network-error {
            animation: shake 0.5s ease-in-out;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        /* Mobile Navigation Overlay */
        .mobile-nav-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .mobile-nav-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        /* Responsive */
        @media (max-width: 1024px) {
            .sidebar {
                width: 80px;
            }
            
            .nav-item span {
                display: none;
            }
            
            .user-info {
                display: none;
            }
        }
        
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .header-actions {
                width: 100%;
                justify-content: space-between;
            }
            
            .main-content {
                padding: 16px;
            }
        }
        
        /* Mobile Menu Button */
        .mobile-menu-btn {
            display: none;
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: var(--primary);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transition: var(--transition);
        }

        .mobile-menu-btn:hover {
            background: var(--primary-dark);
            transform: scale(1.05);
        }

        .mobile-menu-btn:active {
            transform: scale(0.95);
        }

        @media (max-width: 1200px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 1024px) {
            .sidebar {
                width: 80px;
            }
            
            .nav-item span {
                display: none;
            }
            
            .logo span {
                display: none;
            }
            
            .sidebar-header {
                justify-content: center;
                padding: 0 16px 20px;
            }
        }
        
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .header {
                flex-direction: column;
                align-items: flex-start;
                gap: 16px;
            }
            
            .header-actions {
                width: 100%;
                justify-content: space-between;
            }
            
            .main-content {
                padding: 16px;
            }
        }

        /* Animation for progress bars */
        @keyframes move {
            0% { background-position: 0 0; }
            100% { background-position: 20px 0; }
        }

        /* Fade in animation for updates */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }

        /* Glow effects */
        .glow {
            position: absolute;
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: radial-gradient(var(--primary), transparent 70%);
            opacity: 0.05;
            filter: blur(40px);
            z-index: -1;
        }
        
        .glow-1 {
            top: 10%;
            right: 10%;
        }
        
        .glow-2 {
            bottom: 10%;
            left: 10%;
        }

        /* Search input */
        .search-container {
            position: relative;
            flex: 1;
        }

        .search-input {
            width: 100%;
            padding: 10px 15px 10px 35px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            color: white;
            font-size: 0.9rem;
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
        }
    </style>
</head>
<body>
    <div class="glow glow-1"></div>
    <div class="glow glow-2"></div>
    
    <div class="app-container">
        <!-- Mobile Toggle Button -->
        <button class="mobile-menu-btn" id="mobileMenuBtn">
            <i class="fas fa-bars"></i>
        </button>

        <!-- Mobile Navigation Menu -->
        <div class="mobile-nav" id="mobileNav">
            <div class="mobile-nav-header">
                <div class="mobile-nav-logo">
                    <i class="fas fa-link logo-icon"></i>
                    <span>sBTC Relayer</span>
                </div>
                <button class="mobile-nav-close" id="mobileNavClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <ul class="mobile-nav-links">
                <li class="mobile-nav-item active">
                    <a href="#" class="mobile-nav-link">
                        <i class="fas fa-chart-line"></i>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li class="mobile-nav-item">
                    <a href="BitcoinNode.html" class="mobile-nav-link">
                        <i class="fab fa-bitcoin"></i>
                        <span>Bitcoin Node</span>
                    </a>
                </li>
                <li class="mobile-nav-item">
                    <a href="StarknetNode.html" class="mobile-nav-link">
                        <i class="fas fa-layer-group"></i>
                        <span>Starknet Node</span>
                    </a>
                </li>
                <li class="mobile-nav-item">
                    <a href="SPVProofs.html" class="mobile-nav-link">
                        <i class="fas fa-file-contract"></i>
                        <span>SPV Proofs</span>
                    </a>
                </li>
                <li class="mobile-nav-item">
                    <a href="Operators.html" class="mobile-nav-link">
                        <i class="fas fa-server"></i>
                        <span>Operators</span>
                    </a>
                </li>
                <li class="mobile-nav-item">
                    <a href="Security.html" class="mobile-nav-link">
                        <i class="fas fa-shield-alt"></i>
                        <span>Security</span>
                    </a>
                </li>
                <li class="mobile-nav-item">
                    <a href="ApiDocs.html" class="mobile-nav-link">
                        <i class="fas fa-code"></i>
                        <span>API Docs</span>
                    </a>
                </li>
                <li class="mobile-nav-item">
                    <a href="Lock-Screen.html" class="mobile-nav-link">
                        <i class="fas fa-wallet"></i>
                        <span>Wallet</span>
                    </a>
                </li>
                <li class="mobile-nav-item">
                    <a href="Transactions.html" class="mobile-nav-link">
                        <i class="fas fa-exchange-alt"></i>
                        <span>Transactions</span>
                    </a>
                </li>
                <li class="mobile-nav-item">
                    <a href="Settings.html" class="mobile-nav-link">
                        <i class="fas fa-cogs"></i>
                        <span>Settings</span>
                    </a>
                </li>
            </ul>
        </div>
        
        <!-- Sidebar Navigation -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="#" class="logo">
                    <!-- <i class="fas fa-link logo-icon"></i> -->
                     <img src="../images/image.png" alt="" style="width: 40px; height: 40px; border-radius: 50px;">
                    <span>Bitstark Relayer</span>
                </a>
            </div>
            
            <a href="#" class="nav-item active">
                <i class="fas fa-chart-line"></i>
                <span>Dashboard</span>
            </a>
            
            <a href="BitcoinNode.html" class="nav-item">
                <i class="fab fa-bitcoin"></i>
                <span>Bitcoin Node</span>
            </a>

            <a href="StarknetNode.html" class="nav-item">
                <i class="fas fa-layer-group"></i>
                <span>Starknet Node</span>
            </a>
            
            <a href="SPVProofs.html" class="nav-item">
                <i class="fas fa-file-contract"></i>
                <span>SPV Proofs</span>
            </a>
            
            <a href="Operators.html" class="nav-item">
                <i class="fas fa-server"></i>
                <span>Operators</span>
            </a>
            
            <a href="Security.html" class="nav-item">
                <i class="fas fa-shield-alt"></i>
                <span>Security</span>
            </a>
            
            <a href="ApiDocs.html" class="nav-item">
                <i class="fas fa-code"></i>
                <span>API Docs</span>
            </a>

            <a href="Lock-Screen.html" class="nav-item">
                <i class="fas fa-wallet"></i>
                <span>Wallet</span>
            </a>

            <a href="Transactions.html" class="nav-item">
                <i class="fas fa-exchange-alt"></i>
                <span>Transactions</span>
            </a>
            
            <a href="Settings.html" class="nav-item">
                <i class="fas fa-cogs"></i>
                <span>Settings</span>
            </a>
            
            <!-- Enhanced User Profile Section -->
            <div class="user-profile" id="userProfile">
                <div class="user-avatar" id="userAvatar" onclick="handleAvatarClick()" style="cursor: pointer;" title="Click to change avatar or manage profile">
                    <!-- User's profile picture will appear here -->
                    <span id="avatarInitials">U</span>
                    <div class="avatar-overlay" id="avatarOverlay" style="display: none;">
                        <i class="fas fa-camera"></i>
                    </div>
                    <!-- Connection status indicator -->
                    <div class="connection-indicator" id="connectionIndicator" title="Wallet connection status">
                        <i class="fas fa-circle"></i>
                    </div>
                </div>
                <div class="user-info" onclick="showProfileMenu()" style="cursor: pointer; flex: 1;">
                    <div class="user-name" id="userName">User Name</div>
                    <div class="user-role" id="userRole">Registered User</div>
                    <div class="user-address" id="userAddress" style="font-size: 0.7rem; color: var(--gray); margin-top: 2px; font-family: monospace;">
                        <!-- Connected wallet address will appear here -->
                    </div>
                </div>
                
                </div>
        </div>

        <!-- Hidden file input for avatar upload -->
        <input type="file" id="avatarFileInput" accept="image/*" style="display: none;">

        <!-- Main Content -->
        <div class="main-content">
            <div class="header">
                <h1 class="header-title">Relayer System Dashboard</h1>
                <div class="header-actions">
                    <div class="notification-bell" onclick="toggleNotifications()">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge" id="notificationBadge" style="display: none;">0</span>
                    </div>
                    <button class="btn btn-secondary" onclick="showSettingsModal()">
                        <i class="fas fa-cog"></i>
                        Settings
                    </button>
                    <button class="btn btn-secondary refresh-btn" id="refreshBtn">
                        <i class="fas fa-sync-alt"></i>
                        Refresh
                        <div class="refresh-progress"></div>
                        <div class="refresh-states">Click to refresh all data</div>
                    </button>
                    <button class="btn" onclick="showNewTransactionModal()">
                        <i class="fas fa-plus"></i>
                        New Transaction
                    </button>
                </div>

                <!-- Notification Panel -->
                <div class="notification-panel" id="notificationPanel">
                    <div class="notification-header">
                        <h4 style="color: var(--primary); margin: 0; font-size: 1rem;">Notifications</h4>
                        <button onclick="clearAllNotifications()" style="background: none; border: none; color: var(--gray); cursor: pointer; font-size: 0.8rem;">
                            <i class="fas fa-trash"></i> Clear All
                        </button>
                    </div>
                    <div id="notificationList">
                        <!-- Notifications will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Network Status Panel -->
            <div class="network-status" id="networkStatusPanel">
                <div class="network-item" data-network="bitcoin">
                    <div class="network-indicator network-online" id="bitcoin-indicator"></div>
                    <div class="network-name">Bitcoin Network</div>
                    <div class="network-tooltip" id="bitcoin-tooltip">
                        <div class="network-stats">
                            <div class="network-stat">
                                <div class="network-stat-value" id="bitcoin-height">-</div>
                                <div class="network-stat-label">Block Height</div>
                            </div>
                            <div class="network-stat">
                                <div class="network-stat-value" id="bitcoin-peers">-</div>
                                <div class="network-stat-label">Peers</div>
                            </div>
                        </div>
                        <div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid rgba(255,255,255,0.1); font-size: 0.8rem; color: var(--gray);">
                            Last updated: <span id="bitcoin-last-update">-</span>
                        </div>
                    </div>
                </div>
                <div class="network-item" data-network="starknet">
                    <div class="network-indicator network-online" id="starknet-indicator"></div>
                    <div class="network-name">Starknet Network</div>
                    <div class="network-tooltip" id="starknet-tooltip">
                        <div class="network-stats">
                            <div class="network-stat">
                                <div class="network-stat-value" id="starknet-height">-</div>
                                <div class="network-stat-label">Block Height</div>
                            </div>
                            <div class="network-stat">
                                <div class="network-stat-value" id="starknet-status">-</div>
                                <div class="network-stat-label">Status</div>
                            </div>
                        </div>
                        <div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid rgba(255,255,255,0.1); font-size: 0.8rem; color: var(--gray);">
                            Last updated: <span id="starknet-last-update">-</span>
                        </div>
                    </div>
                </div>
                <div class="network-item" data-network="relayer">
                    <div class="network-indicator network-online" id="relayer-indicator"></div>
                    <div class="network-name">Relayer Service</div>
                    <div class="network-tooltip" id="relayer-tooltip">
                        <div class="network-stats">
                            <div class="network-stat">
                                <div class="network-stat-value" id="relayer-uptime">-</div>
                                <div class="network-stat-label">Uptime</div>
                            </div>
                            <div class="network-stat">
                                <div class="network-stat-value" id="relayer-load">-</div>
                                <div class="network-stat-label">Load</div>
                            </div>
                        </div>
                        <div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid rgba(255,255,255,0.1); font-size: 0.8rem; color: var(--gray);">
                            Last updated: <span id="relayer-last-update">-</span>
                        </div>
                    </div>
                </div>
                <div class="network-item" data-network="api">
                    <div class="network-indicator network-online" id="api-indicator"></div>
                    <div class="network-name">API Gateway</div>
                    <div class="network-tooltip" id="api-tooltip">
                        <div class="network-stats">
                            <div class="network-stat">
                                <div class="network-stat-value" id="api-response">-</div>
                                <div class="network-stat-label">Response Time</div>
                            </div>
                            <div class="network-stat">
                                <div class="network-stat-value" id="api-requests">-</div>
                                <div class="network-stat-label">Req/min</div>
                            </div>
                        </div>
                        <div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid rgba(255,255,255,0.1); font-size: 0.8rem; color: var(--gray);">
                            Last updated: <span id="api-last-update">-</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-title">BITCOIN HEIGHT</div>
                        <div class="stat-icon bitcoin-icon">
                            <i class="fab fa-bitcoin"></i>
                        </div>
                    </div>
                    <div class="stat-value">788,543</div>
                    <div class="stat-change positive">
                        <i class="fas fa-arrow-up"></i>
                        +124 blocks
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-title">STARKNET HEADERS</div>
                        <div class="stat-icon starknet-icon">
                            <i class="fas fa-layer-group"></i>
                        </div>
                    </div>
                    <div class="stat-value">788,412</div>
                    <div class="stat-change positive">
                        <i class="fas fa-arrow-up"></i>
                        +98 headers
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-title">SPV PROOFS BUILT</div>
                        <div class="stat-icon proof-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                    </div>
                    <div class="stat-value">12,847</div>
                    <div class="stat-change positive">
                        <i class="fas fa-arrow-up"></i>
                        +43 today
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-title">ACTIVE OPERATORS</div>
                        <div class="stat-icon operator-icon">
                            <i class="fas fa-server"></i>
                        </div>
                    </div>
                    <div class="stat-value">5/7</div>
                    <div class="stat-change negative">
                        <i class="fas fa-arrow-down"></i>
                        -2 offline
                    </div>
                </div>
            </div>
            
            <!-- Alerts Section -->
            <div class="alert alert-warning">
                <div class="alert-icon">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="alert-content">
                    <div class="alert-title">Operator Node 03 Offline</div>
                    <div class="alert-description">Node has been offline for 45 minutes. Check connectivity.</div>
                </div>
            </div>
            
            <div class="alert alert-info">
                <div class="alert-icon">
                    <i class="fas fa-info-circle"></i>
                </div>
                <div class="alert-content">
                    <div class="alert-title">Bitcoin Reorg Detected</div>
                    <div class="alert-description">Reorganization at height 788,541. 2 blocks were orphaned.</div>
                </div>
            </div>
            
            <!-- Dashboard Grid -->
            <div class="dashboard-grid">
                <!-- Left Column -->
                <div>
                    <!-- System Status Card -->
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">System Status</h2>
                            <div class="card-actions">
                                <button class="btn btn-sm btn-secondary" onclick="showLogsModal()">
                                    <i class="fas fa-history"></i>
                                    View Logs
                                </button>
                            </div>
                        </div>
                        
                        <div class="progress-container">
                            <div class="progress-header">
                                <div class="progress-label">Bitcoin Sync</div>
                                <div class="progress-value">100%</div>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 100%; background: linear-gradient(90deg, var(--bitcoin-orange), #f9b366);"></div>
                            </div>
                        </div>
                        
                        <div class="progress-container">
                            <div class="progress-header">
                                <div class="progress-label">Proof Construction</div>
                                <div class="progress-value">60%</div>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 60%; background: linear-gradient(90deg, var(--secondary), #34d399);"></div>
                            </div>
                        </div>
                        
                        <div class="progress-container">
                            <div class="progress-header">
                                <div class="progress-label">Starknet Submission</div>
                                <div class="progress-value">45%</div>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 45%; background: linear-gradient(90deg, var(--starknet-purple), #a855f7);"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Recent Deposits Card -->
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">Recent Deposit Requests</h2>
                            <div class="card-actions">
                                <button class="btn btn-sm btn-secondary" onclick="exportTransactionData()">
                                    <i class="fas fa-download"></i>
                                    Export
                                </button>
                            </div>
                        </div>
                        
                        <div class="filter-bar">
                            <div class="search-container">
                                <i class="fas fa-search search-icon"></i>
                                <input type="text" id="searchInput" class="search-input" placeholder="Search by ID, amount, or status...">
                            </div>
                            <select class="filter-select" id="statusFilter">
                                <option value="all">All Statuses</option>
                                <option value="pending">Pending</option>
                                <option value="processing">Processing</option>
                                <option value="completed">Completed</option>
                                <option value="failed">Failed</option>
                            </select>

                            <select class="filter-select" id="timeFilter">
                                <option value="all">All Time</option>
                                <option value="24h">Last 24 Hours</option>
                                <option value="7d">Last 7 Days</option>
                                <option value="30d">Last 30 Days</option>
                            </select>
                        </div>
                        
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Deposit ID</th>
                                    <th>Amount</th>
                                    <th>Status</th>
                                    <th>Created</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>DEP-7832</td>
                                    <td>0.25 BTC</td>
                                    <td>
                                        <span class="status-badge status-completed">
                                            <i class="fas fa-check-circle"></i>
                                            Completed
                                        </span>
                                    </td>
                                    <td>2 hours ago</td>
                                </tr>
                                <tr>
                                    <td>DEP-7831</td>
                                    <td>1.50 BTC</td>
                                    <td>
                                        <span class="status-badge status-processing">
                                            <i class="fas fa-spinner fa-spin"></i>
                                            Building Proof
                                        </span>
                                    </td>
                                    <td>3 hours ago</td>
                                </tr>
                                <tr>
                                    <td>DEP-7830</td>
                                    <td>0.75 BTC</td>
                                    <td>
                                        <span class="status-badge status-pending">
                                            <i class="fas fa-clock"></i>
                                            Waiting for Confirmations
                                        </span>
                                    </td>
                                    <td>5 hours ago</td>
                                </tr>
                                <tr>
                                    <td>DEP-7829</td>
                                    <td>0.10 BTC</td>
                                    <td>
                                        <span class="status-badge status-failed">
                                            <i class="fas fa-exclamation-circle"></i>
                                            Invalid Tx
                                        </span>
                                    </td>
                                    <td>8 hours ago</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- API Endpoints Card -->
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">API Endpoints</h2>
                            <div class="card-actions">
                                <button class="btn btn-sm" onclick="generateApiKey()">
                                    <i class="fas fa-key"></i>
                                    Generate API Key
                                </button>
                            </div>
                        </div>
                        
                        <div class="endpoint">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <span class="endpoint-method">POST</span>
                                    <span class="endpoint-path">/api/deposit_notify</span>
                                </div>
                                <button onclick="testEndpoint('deposit_notify')" class="btn btn-sm" style="background: var(--secondary);">
                                    <i class="fas fa-play"></i> Test
                                </button>
                            </div>
                            <div class="endpoint-description">
                                Notify the relayer of a new Bitcoin deposit. Requires API key authentication.
                            </div>
                            <div class="code-block">
                                {<br>
                                &nbsp;&nbsp;"txid": "abc123...",<br>
                                &nbsp;&nbsp;"amount": 0.5,<br>
                                &nbsp;&nbsp;"user_id": "user_123",<br>
                                &nbsp;&nbsp;"deposit_id": "dep_456"<br>
                                }
                            </div>
                            <div id="response_deposit_notify" class="api-response" style="display: none; margin-top: 15px;"></div>
                        </div>

                        <div class="endpoint">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <span class="endpoint-method">GET</span>
                                    <span class="endpoint-path">/api/deposit_status/{deposit_id}</span>
                                </div>
                                <button onclick="testEndpoint('deposit_status')" class="btn btn-sm" style="background: var(--secondary);">
                                    <i class="fas fa-play"></i> Test
                                </button>
                            </div>
                            <div class="endpoint-description">
                                Check the status of a deposit transaction by its ID.
                            </div>
                            <div id="response_deposit_status" class="api-response" style="display: none; margin-top: 15px;"></div>
                        </div>
                    </div>
                </div>

                <!-- Right Column -->
                <div>
                    <!-- Recent Activity Timeline -->
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">Recent Activity</h2>
                            <div class="card-actions">
                                <button class="btn btn-sm btn-secondary" onclick="showAllActivity()">
                                    <i class="fas fa-history"></i>
                                    View All
                                </button>
                            </div>
                        </div>
                        
                        <div class="timeline">
                            <div class="timeline-item">
                                <div class="timeline-time">2 minutes ago</div>
                                <div class="timeline-content">New deposit request received: DEP-7832 (0.25 BTC)</div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-time">15 minutes ago</div>
                                <div class="timeline-content">SPV proof generated for transaction abc123</div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-time">45 minutes ago</div>
                                <div class="timeline-content">Operator 03 went offline. Investigating connectivity issues.</div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-time">1 hour ago</div>
                                <div class="timeline-content">Bitcoin chain reorganization detected at height 788,541</div>
                            </div>
                        </div>
                    </div>
                
                <!-- Right Column -->
                <div>
                    <!-- Operators Card -->
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">Operator Nodes</h2>
                            <div class="card-actions">
                                <button class="btn btn-sm" onclick="showAddNodeModal()">
                                    <i class="fas fa-plus"></i>
                                    Add Node
                                </button>
                            </div>
                        </div>
                        
                        <ul class="operator-list">
                            <li class="operator-item" onclick="showOperatorDetails(1)">
                                <div class="operator-avatar">
                                    <i class="fas fa-server"></i>
                                </div>
                                <div class="operator-details">
                                    <div class="operator-name">Operator 01</div>
                                    <div class="operator-meta">Bond: 2.5 BTC • Munich</div>
                                </div>
                                <div class="operator-status status-online"></div>
                            </li>

                            <li class="operator-item" onclick="showOperatorDetails(2)">
                                <div class="operator-avatar">
                                    <i class="fas fa-server"></i>
                                </div>
                                <div class="operator-details">
                                    <div class="operator-name">Operator 02</div>
                                    <div class="operator-meta">Bond: 2.0 BTC • Tokyo</div>
                                </div>
                                <div class="operator-status status-online"></div>
                            </li>

                            <li class="operator-item" onclick="showOperatorDetails(3)">
                                <div class="operator-avatar">
                                    <i class="fas fa-server"></i>
                                </div>
                                <div class="operator-details">
                                    <div class="operator-name">Operator 03</div>
                                    <div class="operator-meta">Bond: 1.8 BTC • Virginia</div>
                                </div>
                                <div class="operator-status status-offline"></div>
                            </li>

                            <li class="operator-item" onclick="showOperatorDetails(4)">
                                <div class="operator-avatar">
                                    <i class="fas fa-server"></i>
                                </div>
                                <div class="operator-details">
                                    <div class="operator-name">Operator 04</div>
                                    <div class="operator-meta">Bond: 2.2 BTC • Singapore</div>
                                </div>
                                <div class="operator-status status-syncing"></div>
                            </li>
                        </ul>
                    </div>
                    
                    <!-- Withdrawal Requests Card -->
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">Withdrawal Requests</h2>
                            <div class="card-actions">
                                <button class="btn btn-sm btn-secondary" onclick="showAllWithdrawalsModal()">
                                    <i class="fas fa-history"></i>
                                    View All
                                </button>
                            </div>
                        </div>
                        
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Withdrawal ID</th>
                                    <th>Amount</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>WD-4521</td>
                                    <td>0.35 BTC</td>
                                    <td>
                                        <span class="status-badge status-processing">
                                            <i class="fas fa-spinner fa-spin"></i>
                                            Signing
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td>WD-4520</td>
                                    <td>1.20 BTC</td>
                                    <td>
                                        <span class="status-badge status-pending">
                                            <i class="fas fa-clock"></i>
                                            Awaiting Signatures
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td>WD-4519</td>
                                    <td>0.75 BTC</td>
                                    <td>
                                        <span class="status-badge status-completed">
                                            <i class="fas fa-check-circle"></i>
                                            Completed
                                        </span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- System Info Card -->
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">System Information</h2>
                            <div class="card-actions">
                                <button class="btn btn-sm btn-secondary" onclick="toggleCharts()">
                                    <i class="fas fa-chart-line"></i>
                                    <span id="chartToggleText">Show Charts</span>
                                </button>
                            </div>
                        </div>

                        <div class="progress-container">
                            <div class="progress-header">
                                <div class="progress-label">CPU Usage</div>
                                <div class="progress-value" id="cpuValue">42%</div>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="cpuBar" style="background: linear-gradient(90deg, var(--info), #6ba8ff); width: 42%;"></div>
                            </div>
                        </div>

                        <div class="progress-container">
                            <div class="progress-header">
                                <div class="progress-label">Memory Usage</div>
                                <div class="progress-value" id="memValue">64%</div>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="memBar" style="background: linear-gradient(90deg, var(--warning), #ffca73); width: 64%;"></div>
                            </div>
                        </div>

                        <div class="progress-container">
                            <div class="progress-header">
                                <div class="progress-label">Disk Space</div>
                                <div class="progress-value" id="diskValue">78%</div>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="diskBar" style="background: linear-gradient(90deg, var(--danger), #ff8e8e); width: 78%;"></div>
                            </div>
                        </div>

                        <!-- Charts Section -->
                        <div id="chartsSection" style="display: none; margin-top: 25px;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                                <div>
                                    <h4 style="color: var(--light); margin-bottom: 15px; font-size: 0.9rem;">System Resources (24h)</h4>
                                    <canvas id="systemChart" width="200" height="150"></canvas>
                                </div>
                                <div>
                                    <h4 style="color: var(--light); margin-bottom: 15px; font-size: 0.9rem;">Transaction Volume</h4>
                                    <canvas id="transactionChart" width="200" height="150"></canvas>
                                </div>
                            </div>
                            <div>
                                <h4 style="color: var(--light); margin-bottom: 15px; font-size: 0.9rem;">Network Activity</h4>
                                <canvas id="networkChart" width="400" height="120"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Bitcoin-Starknet Bridge Dashboard - Real Data Integration
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 Dashboard: Initializing...');

            // Initialize avatar upload functionality FIRST
            initializeAvatarUpload();

            // Initialize user profile
            updateUserProfile();

            // Initialize connection status
            updateConnectionStatus('disconnected');

            // Test avatar functionality after a short delay
            setTimeout(() => {
                console.log('🧪 Dashboard: Running avatar system test...');
                testAvatarFunctionality();
            }, 1000);

            // Initialize profile menu functionality
            initializeProfileMenu();

            // Initialize network status monitoring
            initializeNetworkStatus();

            // Initialize data fetching
            fetchBitcoinData();
            fetchStarknetData();
            fetchSystemData();
            fetchTransactionData();

            // Mobile navigation menu toggle
            const mobileMenuBtn = document.getElementById('mobileMenuBtn');
            const mobileNav = document.getElementById('mobileNav');
            const mobileNavClose = document.getElementById('mobileNavClose');
            const mobileNavLinks = document.querySelectorAll('.mobile-nav-link');

            // Create overlay element
            const overlay = document.createElement('div');
            overlay.className = 'mobile-nav-overlay';
            document.body.appendChild(overlay);

            // Toggle mobile menu
            function toggleMobileMenu() {
                mobileNav.classList.toggle('active');
                overlay.classList.toggle('active');
                document.body.style.overflow = mobileNav.classList.contains('active') ? 'hidden' : '';
            }

            // Event listeners
            mobileMenuBtn.addEventListener('click', toggleMobileMenu);
            mobileNavClose.addEventListener('click', toggleMobileMenu);
            overlay.addEventListener('click', toggleMobileMenu);

            // Close menu when clicking on links
            mobileNavLinks.forEach(link => {
                link.addEventListener('click', function() {
                    toggleMobileMenu();
                });
            });

            // Close menu on escape key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && mobileNav.classList.contains('active')) {
                    toggleMobileMenu();
                }
            });

            // Enhanced Refresh Button Functionality
            class RefreshManager {
                constructor() {
                    this.refreshBtn = document.getElementById('refreshBtn');
                    this.progressBar = this.refreshBtn.querySelector('.refresh-progress');
                    this.statesTooltip = this.refreshBtn.querySelector('.refresh-states');
                    this.isRefreshing = false;
                    this.lastRefreshTime = null;
                    this.refreshHistory = [];
                    this.maxHistorySize = 10;

                    this.init();
                }

                init() {
                    this.setupEventListeners();
                    this.updateStatesTooltip();
                    this.startPeriodicTimeUpdate();
                }

                setupEventListeners() {
                    this.refreshBtn.addEventListener('click', () => this.handleRefresh());
                    this.refreshBtn.addEventListener('contextmenu', (e) => this.handleRightClick(e));
                }

                async handleRefresh(forceFull = false) {
                    if (this.isRefreshing) return;

                    this.isRefreshing = true;
                    this.refreshBtn.disabled = true;
                    this.refreshBtn.classList.remove('success', 'error');
                    this.refreshBtn.classList.add('loading');

                    // Update states tooltip
                    this.updateStatesTooltip('Refreshing all data...');

                    // Start progress animation
                    this.animateProgress();

                    try {
                        // Play refresh sound if enabled
                        if (userSettings.notifications.sound) {
                            this.playRefreshSound('start');
                        }

                        const startTime = Date.now();

                        // Comprehensive refresh with progress tracking
                        const refreshTasks = [
                            { name: 'Bitcoin Network', task: () => fetchBitcoinData(), weight: 25 },
                            { name: 'Starknet Network', task: () => fetchStarknetData(), weight: 25 },
                            { name: 'System Status', task: () => fetchSystemData(), weight: 20 },
                            { name: 'Transactions', task: () => fetchTransactionData(), weight: 15 },
                            { name: 'Network Status', task: () => checkAllNetworks(), weight: 15 }
                        ];

                        let totalProgress = 0;
                        const results = [];

                        for (const task of refreshTasks) {
                            try {
                                await task.task();
                                results.push({ task: task.name, success: true });
                                totalProgress += task.weight;
                                this.updateProgress(totalProgress);
                                await this.delay(200); // Brief pause between tasks
                            } catch (error) {
                                console.error(`Error refreshing ${task.name}:`, error);
                                results.push({ task: task.name, success: false, error: error.message });
                                // Continue with other tasks even if one fails
                            }
                        }

                        const endTime = Date.now();
                        const duration = endTime - startTime;

                        // Record refresh in history
                        this.addToHistory({
                            timestamp: new Date(),
                            duration: duration,
                            success: results.every(r => r.success),
                            results: results
                        });

                        // Show success state
                        this.showSuccessState(duration);

                        // Play success sound
                        if (userSettings.notifications.sound) {
                            this.playRefreshSound('success');
                        }

                        // Show detailed notification
                        const successCount = results.filter(r => r.success).length;
                        const failureCount = results.length - successCount;

                        let notificationMessage = `Refreshed ${successCount}/${results.length} data sources in ${duration}ms`;
                        if (failureCount > 0) {
                            notificationMessage += `. ${failureCount} failed.`;
                        }

                        addNotification(
                            'Data Refresh Complete',
                            notificationMessage,
                            failureCount > 0 ? 'warning' : 'success'
                        );

                        this.lastRefreshTime = new Date();

                    } catch (error) {
                        console.error('Refresh error:', error);
                        this.showErrorState(error.message);

                        // Play error sound
                        if (userSettings.notifications.sound) {
                            this.playRefreshSound('error');
                        }

                        addNotification('Refresh Failed', error.message, 'error');
                    } finally {
                        this.isRefreshing = false;
                        this.resetButtonState();
                    }
                }

                handleRightClick(e) {
                    e.preventDefault();
                    this.showRefreshContextMenu(e);
                }

                showRefreshContextMenu(e) {
                    // Remove existing context menu
                    const existingMenu = document.querySelector('.refresh-context-menu');
                    if (existingMenu) {
                        existingMenu.remove();
                    }

                    const menu = document.createElement('div');
                    menu.className = 'refresh-context-menu';
                    menu.style.cssText = `
                        position: absolute;
                        top: ${e.pageY}px;
                        left: ${e.pageX}px;
                        background: var(--darker);
                        border: 1px solid rgba(255, 255, 255, 0.1);
                        border-radius: 8px;
                        padding: 8px 0;
                        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
                        z-index: 1000;
                        min-width: 180px;
                    `;

                    const menuItems = [
                        { label: 'Full Refresh', action: () => this.handleRefresh(true), icon: 'fas fa-sync-alt' },
                        { label: 'Quick Refresh', action: () => this.handleRefresh(false), icon: 'fas fa-bolt' },
                        { label: 'Bitcoin Only', action: () => this.refreshBitcoinOnly(), icon: 'fab fa-bitcoin' },
                        { label: 'Starknet Only', action: () => this.refreshStarknetOnly(), icon: 'fas fa-layer-group' },
                        { label: 'Network Status', action: () => this.refreshNetworkStatus(), icon: 'fas fa-network-wired' },
                        { label: 'Clear Cache', action: () => this.clearCache(), icon: 'fas fa-trash' },
                        { label: 'Refresh History', action: () => this.showRefreshHistory(), icon: 'fas fa-history' }
                    ];

                    menuItems.forEach(item => {
                        const menuItem = document.createElement('div');
                        menuItem.style.cssText = `
                            padding: 10px 15px;
                            color: var(--light);
                            cursor: pointer;
                            display: flex;
                            align-items: center;
                            gap: 10px;
                            font-size: 0.9rem;
                            transition: background 0.2s ease;
                        `;

                        menuItem.innerHTML = `<i class="${item.icon}"></i> ${item.label}`;

                        menuItem.addEventListener('mouseenter', () => {
                            menuItem.style.background = 'rgba(124, 58, 237, 0.1)';
                        });

                        menuItem.addEventListener('mouseleave', () => {
                            menuItem.style.background = 'transparent';
                        });

                        menuItem.addEventListener('click', () => {
                            item.action();
                            menu.remove();
                        });

                        menu.appendChild(menuItem);
                    });

                    document.body.appendChild(menu);

                    // Close menu when clicking outside
                    const closeMenu = (e) => {
                        if (!menu.contains(e.target)) {
                            menu.remove();
                            document.removeEventListener('click', closeMenu);
                        }
                    };

                    setTimeout(() => {
                        document.addEventListener('click', closeMenu);
                    }, 100);
                }

                animateProgress() {
                    let progress = 0;
                    const increment = () => {
                        if (!this.isRefreshing) return;

                        progress += Math.random() * 15;
                        if (progress > 90) progress = 90; // Cap at 90% until completion

                        this.updateProgress(progress);

                        if (progress < 90) {
                            setTimeout(increment, 100 + Math.random() * 200);
                        }
                    };

                    increment();
                }

                updateProgress(percentage) {
                    if (this.progressBar) {
                        this.progressBar.style.width = percentage + '%';
                    }
                }

                showSuccessState(duration) {
                    this.refreshBtn.classList.remove('loading');
                    this.refreshBtn.classList.add('success');
                    this.updateProgress(100);

                    const durationText = duration < 1000 ? `${duration}ms` : `${(duration/1000).toFixed(1)}s`;
                    this.updateStatesTooltip(`✓ Refreshed in ${durationText}`);

                    setTimeout(() => {
                        this.refreshBtn.classList.remove('success');
                        this.updateProgress(0);
                    }, 3000);
                }

                showErrorState(errorMessage) {
                    this.refreshBtn.classList.remove('loading');
                    this.refreshBtn.classList.add('error');
                    this.updateProgress(0);
                    this.updateStatesTooltip(`✗ ${errorMessage}`);

                    setTimeout(() => {
                        this.refreshBtn.classList.remove('error');
                    }, 4000);
                }

                resetButtonState() {
                    setTimeout(() => {
                        this.refreshBtn.disabled = false;
                        this.updateStatesTooltip();
                        this.updateProgress(0);
                    }, 1000);
                }

                updateStatesTooltip(customMessage = null) {
                    if (!this.statesTooltip) return;

                    if (customMessage) {
                        this.statesTooltip.textContent = customMessage;
                        return;
                    }

                    const now = new Date();
                    let tooltipText = 'Click to refresh all data';

                    if (this.lastRefreshTime) {
                        const timeDiff = Math.floor((now - this.lastRefreshTime) / 1000);
                        if (timeDiff < 60) {
                            tooltipText = `Last refreshed ${timeDiff}s ago`;
                        } else if (timeDiff < 3600) {
                            tooltipText = `Last refreshed ${Math.floor(timeDiff/60)}m ago`;
                        } else {
                            tooltipText = `Last refreshed ${Math.floor(timeDiff/3600)}h ago`;
                        }
                    }

                    this.statesTooltip.textContent = tooltipText;
                }

                startPeriodicTimeUpdate() {
                    setInterval(() => {
                        if (!this.isRefreshing) {
                            this.updateStatesTooltip();
                        }
                    }, 5000);
                }

                addToHistory(refreshRecord) {
                    this.refreshHistory.unshift(refreshRecord);
                    if (this.refreshHistory.length > this.maxHistorySize) {
                        this.refreshHistory = this.refreshHistory.slice(0, this.maxHistorySize);
                    }

                    // Save to localStorage
                    localStorage.setItem('refreshHistory', JSON.stringify(this.refreshHistory));
                }

                // Selective refresh methods
                async refreshBitcoinOnly() {
                    try {
                        await fetchBitcoinData();
                        addNotification('Bitcoin Data Updated', 'Bitcoin network data refreshed', 'success');
                    } catch (error) {
                        addNotification('Bitcoin Refresh Failed', error.message, 'error');
                    }
                }

                async refreshStarknetOnly() {
                    try {
                        await fetchStarknetData();
                        addNotification('Starknet Data Updated', 'Starknet network data refreshed', 'success');
                    } catch (error) {
                        addNotification('Starknet Refresh Failed', error.message, 'error');
                    }
                }

                async refreshNetworkStatus() {
                    try {
                        await checkAllNetworks();
                        addNotification('Network Status Updated', 'All network connections checked', 'success');
                    } catch (error) {
                        addNotification('Network Check Failed', error.message, 'error');
                    }
                }

                clearCache() {
                    localStorage.removeItem('userData');
                    localStorage.removeItem('userSettings');
                    localStorage.removeItem('refreshHistory');
                    addNotification('Cache Cleared', 'All cached data has been removed', 'info');
                }

                showRefreshHistory() {
                    const history = JSON.parse(localStorage.getItem('refreshHistory')) || [];

                    if (history.length === 0) {
                        addNotification('No History', 'No refresh history available', 'info');
                        return;
                    }

                    const modal = document.createElement('div');
                    modal.style.cssText = `
                        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                        background: rgba(0,0,0,0.8); display: flex; align-items: center;
                        justify-content: center; z-index: 1000;
                    `;

                    const historyHtml = history.map((record, index) => {
                        const timeAgo = this.getTimeAgo(record.timestamp);
                        const duration = record.duration < 1000 ? `${record.duration}ms` : `${(record.duration/1000).toFixed(1)}s`;
                        const statusIcon = record.success ? 'fa-check-circle' : 'fa-exclamation-triangle';
                        const statusColor = record.success ? 'var(--secondary)' : 'var(--danger)';

                        return `
                            <div style="display: flex; align-items: center; gap: 15px; padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.1);">
                                <div style="color: ${statusColor};">
                                    <i class="fas ${statusIcon}"></i>
                                </div>
                                <div style="flex: 1;">
                                    <div style="color: var(--light); font-size: 0.9rem;">${timeAgo}</div>
                                    <div style="color: var(--gray); font-size: 0.8rem;">${duration} • ${record.results.filter(r => r.success).length}/${record.results.length} tasks</div>
                                </div>
                            </div>
                        `;
                    }).join('');

                    modal.innerHTML = `
                        <div style="background: var(--darker); padding: 30px; border-radius: 16px; max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto;">
                            <h3 style="color: var(--primary); margin-bottom: 20px;">Refresh History</h3>
                            <div style="margin-bottom: 20px;">
                                ${historyHtml}
                            </div>
                            <button onclick="this.parentElement.parentElement.remove()" style="background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer;">Close</button>
                        </div>
                    `;

                    document.body.appendChild(modal);

                    modal.addEventListener('click', function(e) {
                        if (e.target === modal) {
                            modal.remove();
                        }
                    });
                }

                getTimeAgo(timestamp) {
                    const now = new Date();
                    const diff = now - new Date(timestamp);
                    const minutes = Math.floor(diff / 60000);
                    const hours = Math.floor(diff / 3600000);
                    const days = Math.floor(diff / 86400000);

                    if (minutes < 1) return 'Just now';
                    if (minutes < 60) return `${minutes}m ago`;
                    if (hours < 24) return `${hours}h ago`;
                    return `${days}d ago`;
                }

                delay(ms) {
                    return new Promise(resolve => setTimeout(resolve, ms));
                }

                playRefreshSound(type) {
                    try {
                        // Create audio context for sound feedback
                        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                        const oscillator = audioContext.createOscillator();
                        const gainNode = audioContext.createGain();

                        oscillator.connect(gainNode);
                        gainNode.connect(audioContext.destination);

                        switch (type) {
                            case 'start':
                                oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                                oscillator.frequency.setValueAtTime(400, audioContext.currentTime + 0.1);
                                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                                oscillator.start(audioContext.currentTime);
                                oscillator.stop(audioContext.currentTime + 0.1);
                                break;

                            case 'success':
                                oscillator.frequency.setValueAtTime(600, audioContext.currentTime);
                                oscillator.frequency.setValueAtTime(800, audioContext.currentTime + 0.1);
                                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                                oscillator.start(audioContext.currentTime);
                                oscillator.stop(audioContext.currentTime + 0.1);
                                break;

                            case 'error':
                                oscillator.frequency.setValueAtTime(200, audioContext.currentTime);
                                oscillator.frequency.setValueAtTime(150, audioContext.currentTime + 0.2);
                                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                                oscillator.start(audioContext.currentTime);
                                oscillator.stop(audioContext.currentTime + 0.2);
                                break;
                        }
                    } catch (error) {
                        console.log('Audio not available:', error);
                    }
                }
            }

            // Initialize the refresh manager
            const refreshManager = new RefreshManager();

            // Filter functionality
            const filterSelects = document.querySelectorAll('.filter-select');
            filterSelects.forEach(select => {
                select.addEventListener('change', function() {
                    applyFilters();
                });
            });

            // Search functionality
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('input', function() {
                    applyFilters();
                });
            }

            // Real-time updates every 30 seconds
            setInterval(() => {
                fetchBitcoinData();
                fetchStarknetData();
                updateTransactionStatuses();
                updateSystemResources();

                // Generate random notifications occasionally
                if (Math.random() < 0.3) { // 30% chance every 30 seconds
                    generateRandomNotifications();
                }
            }, 30000);

            // Apply saved settings
            applySettings();

            // Add some initial notifications
            setTimeout(() => {
                addNotification('Welcome', 'Dashboard loaded successfully', 'success');
                addNotification('System Status', 'All systems operational', 'info');
            }, 1000);
        });

        // Network Status Monitoring System
        let networkStatusData = {
            bitcoin: {
                status: 'online',
                height: 0,
                peers: 0,
                lastUpdate: null,
                responseTime: 0
            },
            starknet: {
                status: 'online',
                height: 0,
                status: 'synced',
                lastUpdate: null,
                responseTime: 0
            },
            relayer: {
                status: 'online',
                uptime: '99.9%',
                load: '45%',
                lastUpdate: null,
                responseTime: 0
            },
            api: {
                status: 'online',
                responseTime: '120ms',
                requests: '45/min',
                lastUpdate: null,
                responseTime: 0
            }
        };

        // Initialize network status monitoring
        function initializeNetworkStatus() {
            // Initial network check
            checkAllNetworks();

            // Set up periodic checks every 15 seconds
            setInterval(checkAllNetworks, 15000);

            // Add click handlers for network items
            document.querySelectorAll('.network-item').forEach(item => {
                item.addEventListener('click', function() {
                    const network = this.dataset.network;
                    showNetworkDetails(network);
                });
            });

            console.log('Network status monitoring initialized');
        }

        // Check all network statuses
        async function checkAllNetworks() {
            const networks = ['bitcoin', 'starknet', 'relayer', 'api'];

            for (const network of networks) {
                await checkNetworkStatus(network);
                // Small delay between checks to avoid overwhelming
                await new Promise(resolve => setTimeout(resolve, 500));
            }
        }

        // Check individual network status
        async function checkNetworkStatus(network) {
            const startTime = Date.now();
            const indicator = document.getElementById(`${network}-indicator`);
            const tooltip = document.getElementById(`${network}-tooltip`);

            if (!indicator) return;

            // Show checking state
            indicator.className = 'network-indicator network-checking';
            indicator.style.background = 'var(--warning)';
            indicator.style.boxShadow = '0 0 0 3px rgba(245, 158, 11, 0.2)';

            try {
                let result;

                switch (network) {
                    case 'bitcoin':
                        result = await checkBitcoinNetwork();
                        break;
                    case 'starknet':
                        result = await checkStarknetNetwork();
                        break;
                    case 'relayer':
                        result = await checkRelayerService();
                        break;
                    case 'api':
                        result = await checkApiGateway();
                        break;
                    default:
                        throw new Error('Unknown network');
                }

                const responseTime = Date.now() - startTime;

                // Update network status data
                networkStatusData[network] = {
                    ...networkStatusData[network],
                    ...result,
                    lastUpdate: new Date(),
                    responseTime: responseTime
                };

                // Update UI
                updateNetworkIndicator(network, 'online');
                updateNetworkTooltip(network);

                // Add notification for status changes
                if (networkStatusData[network].status !== 'online') {
                    addNotification(
                        'Network Status Changed',
                        `${network.charAt(0).toUpperCase() + network.slice(1)} Network is now ${networkStatusData[network].status}`,
                        networkStatusData[network].status === 'online' ? 'success' : 'warning'
                    );
                }

            } catch (error) {
                console.error(`Error checking ${network} network:`, error);

                // Update network status data
                networkStatusData[network] = {
                    ...networkStatusData[network],
                    status: 'offline',
                    lastUpdate: new Date(),
                    responseTime: Date.now() - startTime,
                    error: error.message
                };

                // Update UI for error state
                updateNetworkIndicator(network, 'offline');
                updateNetworkTooltip(network);

                // Add error notification
                addNotification(
                    'Network Error',
                    `Failed to connect to ${network.charAt(0).toUpperCase() + network.slice(1)} Network`,
                    'error'
                );
            }
        }

        // Check Bitcoin network status
        async function checkBitcoinNetwork() {
            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 5000);

                const response = await fetch('https://blockchain.info/q/getblockcount', {
                    signal: controller.signal
                });

                clearTimeout(timeoutId);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }

                const blockHeight = await response.text();
                const height = parseInt(blockHeight);

                // Simulate peer count (real implementation would use different API)
                const peers = Math.floor(Math.random() * 20) + 30;

                return {
                    status: 'online',
                    height: height,
                    peers: peers
                };
            } catch (error) {
                throw error;
            }
        }

        // Check Starknet network status
        async function checkStarknetNetwork() {
            try {
                // Simulate Starknet API call (replace with real Starknet API)
                await new Promise(resolve => setTimeout(resolve, Math.random() * 1000 + 500));

                // Simulate occasional sync issues
                const isSyncing = Math.random() < 0.1;

                return {
                    status: isSyncing ? 'syncing' : 'online',
                    height: Math.floor(Math.random() * 1000) + 788000,
                    status: isSyncing ? 'syncing' : 'synced'
                };
            } catch (error) {
                throw error;
            }
        }

        // Check Relayer service status
        async function checkRelayerService() {
            try {
                // Simulate relayer health check
                await new Promise(resolve => setTimeout(resolve, Math.random() * 500 + 200));

                const uptime = (Math.random() * 0.5 + 99).toFixed(1) + '%';
                const load = Math.floor(Math.random() * 30) + 20 + '%';

                return {
                    status: 'online',
                    uptime: uptime,
                    load: load
                };
            } catch (error) {
                throw error;
            }
        }

        // Check API Gateway status
        async function checkApiGateway() {
            try {
                const startTime = Date.now();

                // Simulate API health check
                await new Promise(resolve => setTimeout(resolve, Math.random() * 300 + 100));

                const responseTime = Math.floor(Math.random() * 200) + 50 + 'ms';
                const requests = Math.floor(Math.random() * 30) + 20 + '/min';

                return {
                    status: 'online',
                    responseTime: responseTime,
                    requests: requests
                };
            } catch (error) {
                throw error;
            }
        }

        // Update network indicator
        function updateNetworkIndicator(network, status) {
            const indicator = document.getElementById(`${network}-indicator`);
            if (!indicator) return;

            // Remove existing classes
            indicator.className = 'network-indicator';

            // Add new status class
            switch (status) {
                case 'online':
                    indicator.classList.add('network-online');
                    indicator.style.background = 'var(--secondary)';
                    indicator.style.boxShadow = '0 0 0 3px rgba(16, 185, 129, 0.2)';
                    break;
                case 'offline':
                    indicator.classList.add('network-offline');
                    indicator.style.background = 'var(--danger)';
                    indicator.style.boxShadow = '0 0 0 3px rgba(239, 68, 68, 0.2)';
                    break;
                case 'syncing':
                    indicator.classList.add('network-online');
                    indicator.style.background = 'var(--warning)';
                    indicator.style.boxShadow = '0 0 0 3px rgba(245, 158, 11, 0.2)';
                    break;
            }

            // Add pulse animation for online status
            if (status === 'online') {
                indicator.classList.add('network-pulse');
                setTimeout(() => {
                    indicator.classList.remove('network-pulse');
                }, 2000);
            }
        }

        // Update network tooltip
        function updateNetworkTooltip(network) {
            const data = networkStatusData[network];
            if (!data) return;

            // Update tooltip values
            switch (network) {
                case 'bitcoin':
                    document.getElementById('bitcoin-height').textContent = data.height?.toLocaleString() || '-';
                    document.getElementById('bitcoin-peers').textContent = data.peers || '-';
                    document.getElementById('bitcoin-last-update').textContent = formatTimeAgo(data.lastUpdate);
                    break;
                case 'starknet':
                    document.getElementById('starknet-height').textContent = data.height?.toLocaleString() || '-';
                    document.getElementById('starknet-status').textContent = data.status || '-';
                    document.getElementById('starknet-last-update').textContent = formatTimeAgo(data.lastUpdate);
                    break;
                case 'relayer':
                    document.getElementById('relayer-uptime').textContent = data.uptime || '-';
                    document.getElementById('relayer-load').textContent = data.load || '-';
                    document.getElementById('relayer-last-update').textContent = formatTimeAgo(data.lastUpdate);
                    break;
                case 'api':
                    document.getElementById('api-response').textContent = data.responseTime || '-';
                    document.getElementById('api-requests').textContent = data.requests || '-';
                    document.getElementById('api-last-update').textContent = formatTimeAgo(data.lastUpdate);
                    break;
            }
        }

        // Show network details modal
        function showNetworkDetails(network) {
            const data = networkStatusData[network];
            if (!data) return;

            const networkNames = {
                bitcoin: 'Bitcoin Network',
                starknet: 'Starknet Network',
                relayer: 'Relayer Service',
                api: 'API Gateway'
            };

            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.8); display: flex; align-items: center;
                justify-content: center; z-index: 1000;
            `;

            const statusColor = data.status === 'online' ? 'var(--secondary)' :
                               data.status === 'offline' ? 'var(--danger)' : 'var(--warning)';

            modal.innerHTML = `
                <div style="background: var(--darker); padding: 30px; border-radius: 16px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto;">
                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 25px;">
                        <div style="width: 60px; height: 60px; border-radius: 50%; background: ${statusColor}; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem; font-weight: 600;">
                            <i class="fas fa-${network === 'bitcoin' ? 'bitcoin' : network === 'starknet' ? 'layer-group' : 'server'}"></i>
                        </div>
                        <div>
                            <h2 style="color: var(--primary); margin: 0; font-size: 1.5rem;">${networkNames[network]}</h2>
                            <div style="color: var(--gray); margin-top: 5px;">Detailed Status Information</div>
                        </div>
                        <div style="margin-left: auto; text-align: center;">
                            <div style="color: ${statusColor}; font-size: 1.5rem;">
                                <i class="fas fa-${data.status === 'online' ? 'check-circle' : data.status === 'offline' ? 'times-circle' : 'sync-alt'}"></i>
                            </div>
                            <div style="color: var(--gray); font-size: 0.8rem; text-transform: capitalize;">${data.status}</div>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 25px;">
                        ${getNetworkDetailFields(network, data)}
                    </div>

                    <div style="margin-bottom: 25px;">
                        <h3 style="color: var(--light); margin-bottom: 15px;">Connection History</h3>
                        <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px;">
                            <canvas id="connectionChart" width="400" height="150"></canvas>
                        </div>
                    </div>

                    <div style="display: flex; gap: 10px; justify-content: flex-end;">
                        <button onclick="testNetworkConnection('${network}')" style="background: var(--info); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer;">
                            <i class="fas fa-plug"></i> Test Connection
                        </button>
                        <button onclick="this.parentElement.parentElement.remove()" style="background: rgba(255,255,255,0.1); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer;">Close</button>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);

            // Initialize connection history chart
            setTimeout(() => {
                initializeConnectionChart(network);
            }, 100);

            // Close modal when clicking outside
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // Get network-specific detail fields
        function getNetworkDetailFields(network, data) {
            const fields = [];

            switch (network) {
                case 'bitcoin':
                    fields.push(
                        `<div style="background: rgba(247, 147, 26, 0.1); padding: 15px; border-radius: 8px; border-left: 4px solid var(--bitcoin-orange);">
                            <div style="color: var(--gray); font-size: 0.9rem;">Block Height</div>
                            <div style="color: var(--light); font-size: 1.2rem; font-weight: 600;">${data.height?.toLocaleString() || 'N/A'}</div>
                        </div>`,
                        `<div style="background: rgba(16, 185, 129, 0.1); padding: 15px; border-radius: 8px; border-left: 4px solid var(--secondary);">
                            <div style="color: var(--gray); font-size: 0.9rem;">Connected Peers</div>
                            <div style="color: var(--light); font-size: 1.2rem; font-weight: 600;">${data.peers || 'N/A'}</div>
                        </div>`,
                        `<div style="background: rgba(59, 130, 246, 0.1); padding: 15px; border-radius: 8px; border-left: 4px solid var(--info);">
                            <div style="color: var(--gray); font-size: 0.9rem;">Response Time</div>
                            <div style="color: var(--light); font-size: 1.2rem; font-weight: 600;">${data.responseTime}ms</div>
                        </div>`
                    );
                    break;
                case 'starknet':
                    fields.push(
                        `<div style="background: rgba(138, 43, 226, 0.1); padding: 15px; border-radius: 8px; border-left: 4px solid var(--starknet-purple);">
                            <div style="color: var(--gray); font-size: 0.9rem;">Block Height</div>
                            <div style="color: var(--light); font-size: 1.2rem; font-weight: 600;">${data.height?.toLocaleString() || 'N/A'}</div>
                        </div>`,
                        `<div style="background: rgba(245, 158, 11, 0.1); padding: 15px; border-radius: 8px; border-left: 4px solid var(--warning);">
                            <div style="color: var(--gray); font-size: 0.9rem;">Sync Status</div>
                            <div style="color: var(--light); font-size: 1.2rem; font-weight: 600;">${data.status || 'N/A'}</div>
                        </div>`,
                        `<div style="background: rgba(59, 130, 246, 0.1); padding: 15px; border-radius: 8px; border-left: 4px solid var(--info);">
                            <div style="color: var(--gray); font-size: 0.9rem;">Response Time</div>
                            <div style="color: var(--light); font-size: 1.2rem; font-weight: 600;">${data.responseTime}ms</div>
                        </div>`
                    );
                    break;
                case 'relayer':
                    fields.push(
                        `<div style="background: rgba(16, 185, 129, 0.1); padding: 15px; border-radius: 8px; border-left: 4px solid var(--secondary);">
                            <div style="color: var(--gray); font-size: 0.9rem;">Service Uptime</div>
                            <div style="color: var(--light); font-size: 1.2rem; font-weight: 600;">${data.uptime || 'N/A'}</div>
                        </div>`,
                        `<div style="background: rgba(245, 158, 11, 0.1); padding: 15px; border-radius: 8px; border-left: 4px solid var(--warning);">
                            <div style="color: var(--gray); font-size: 0.9rem;">System Load</div>
                            <div style="color: var(--light); font-size: 1.2rem; font-weight: 600;">${data.load || 'N/A'}</div>
                        </div>`,
                        `<div style="background: rgba(59, 130, 246, 0.1); padding: 15px; border-radius: 8px; border-left: 4px solid var(--info);">
                            <div style="color: var(--gray); font-size: 0.9rem;">Response Time</div>
                            <div style="color: var(--light); font-size: 1.2rem; font-weight: 600;">${data.responseTime}ms</div>
                        </div>`
                    );
                    break;
                case 'api':
                    fields.push(
                        `<div style="background: rgba(59, 130, 246, 0.1); padding: 15px; border-radius: 8px; border-left: 4px solid var(--info);">
                            <div style="color: var(--gray); font-size: 0.9rem;">Response Time</div>
                            <div style="color: var(--light); font-size: 1.2rem; font-weight: 600;">${data.responseTime || 'N/A'}</div>
                        </div>`,
                        `<div style="background: rgba(16, 185, 129, 0.1); padding: 15px; border-radius: 8px; border-left: 4px solid var(--secondary);">
                            <div style="color: var(--gray); font-size: 0.9rem;">Request Rate</div>
                            <div style="color: var(--light); font-size: 1.2rem; font-weight: 600;">${data.requests || 'N/A'}</div>
                        </div>`,
                        `<div style="background: rgba(124, 58, 237, 0.1); padding: 15px; border-radius: 8px; border-left: 4px solid var(--primary);">
                            <div style="color: var(--gray); font-size: 0.9rem;">Last Check</div>
                            <div style="color: var(--light); font-size: 1.2rem; font-weight: 600;">${formatTimeAgo(data.lastUpdate)}</div>
                        </div>`
                    );
                    break;
            }

            return fields.join('');
        }

        // Test network connection
        function testNetworkConnection(network) {
            addNotification(
                'Connection Test',
                `Testing ${network.charAt(0).toUpperCase() + network.slice(1)} Network connection...`,
                'info'
            );

            // Simulate connection test
            setTimeout(() => {
                const success = Math.random() > 0.1; // 90% success rate
                addNotification(
                    'Connection Test',
                    `${network.charAt(0).toUpperCase() + network.slice(1)} Network ${success ? 'responded successfully' : 'connection failed'}`,
                    success ? 'success' : 'error'
                );
            }, 2000);
        }

        // Initialize connection history chart
        function initializeConnectionChart(network) {
            const ctx = document.getElementById('connectionChart');
            if (!ctx) return;

            // Generate sample connection history data
            const labels = [];
            const responseTimes = [];

            for (let i = 23; i >= 0; i--) {
                const date = new Date(Date.now() - i * 300000); // 5-minute intervals
                labels.push(date.getHours() + ':' + date.getMinutes().toString().padStart(2, '0'));

                // Generate realistic response times
                let baseTime;
                switch (network) {
                    case 'bitcoin': baseTime = 200; break;
                    case 'starknet': baseTime = 300; break;
                    case 'relayer': baseTime = 50; break;
                    case 'api': baseTime = 100; break;
                    default: baseTime = 150;
                }

                const variation = Math.random() * 100 - 50;
                responseTimes.push(Math.max(10, baseTime + variation));
            }

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Response Time (ms)',
                        data: responseTimes,
                        borderColor: 'var(--primary)',
                        backgroundColor: 'rgba(124, 58, 237, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: 'var(--light)',
                                font: { size: 12 }
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: 'var(--gray)', font: { size: 10 } },
                            grid: { color: 'rgba(255,255,255,0.1)' }
                        },
                        y: {
                            ticks: { color: 'var(--gray)', font: { size: 10 } },
                            grid: { color: 'rgba(255,255,255,0.1)' }
                        }
                    }
                }
            });
        }

        // Format time ago
        function formatTimeAgo(timestamp) {
            if (!timestamp) return 'Never';

            const now = new Date();
            const diff = now - timestamp;
            const seconds = Math.floor(diff / 1000);
            const minutes = Math.floor(seconds / 60);
            const hours = Math.floor(minutes / 60);

            if (seconds < 60) return `${seconds}s ago`;
            if (minutes < 60) return `${minutes}m ago`;
            if (hours < 24) return `${hours}h ago`;
            return timestamp.toLocaleDateString();
        }

        // User profile data - load from localStorage or use defaults
        let userData = JSON.parse(localStorage.getItem('userData')) || {
            name: "User Name",
            avatar: null,
            email: "",
            role: "user"
        };

        // User settings - load from localStorage or use defaults
        let userSettings = JSON.parse(localStorage.getItem('userSettings')) || {
            theme: 'dark',
            autoRefresh: true,
            refreshInterval: 30,
            notifications: {
                enabled: true,
                sound: false,
                types: {
                    deposits: true,
                    withdrawals: true,
                    system: true,
                    operators: true
                }
            },
            display: {
                showCharts: false,
                compactView: false,
                animations: true
            }
        };

        // ==========================================
        // ENHANCED USER PROFILE SYSTEM
        // ==========================================

        // Enhanced avatar click handler
        function handleAvatarClick() {
            console.log('🎯 Profile: Avatar clicked, showing options...');

            // Show avatar selection menu
            showAvatarMenu();
        }

        // Show avatar selection menu
        function showAvatarMenu() {
            const avatarElement = document.getElementById('userAvatar');
            if (!avatarElement) return;

            // Remove existing menu
            const existingMenu = document.querySelector('.avatar-menu');
            if (existingMenu) {
                existingMenu.remove();
            }

            const menu = document.createElement('div');
            menu.className = 'avatar-menu';
            menu.style.cssText = `
                position: absolute;
                bottom: 100%;
                left: 50%;
                transform: translateX(-50%);
                background: var(--darker);
                border: 1px solid rgba(255, 255, 255, 0.1);
                border-radius: 12px;
                box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
                min-width: 180px;
                z-index: 1000;
                margin-bottom: 10px;
                opacity: 0;
                visibility: hidden;
                transform: translateX(-50%) translateY(10px);
                transition: var(--transition);
            `;

            menu.innerHTML = `
                <div style="padding: 15px 0;">
                    <div class="avatar-menu-item" onclick="openImageSelector()">
                        <i class="fas fa-camera"></i>
                        <span>Change Avatar</span>
                    </div>
                    <div class="avatar-menu-item" onclick="showProfileSettings()">
                        <i class="fas fa-user-cog"></i>
                        <span>Profile Settings</span>
                    </div>
                    <div class="avatar-menu-item" onclick="manageWallets()">
                        <i class="fas fa-wallet"></i>
                        <span>Manage Wallets</span>
                    </div>
                    <div class="avatar-menu-divider" style="margin: 8px 0;"></div>
                    <div class="avatar-menu-item" onclick="exportProfileData()">
                        <i class="fas fa-download"></i>
                        <span>Export Data</span>
                    </div>
                    <div class="avatar-menu-item" onclick="clearProfileData()">
                        <i class="fas fa-trash"></i>
                        <span>Clear Profile</span>
                    </div>
                </div>
            `;

            // Add menu item styles
            const menuItems = menu.querySelectorAll('.avatar-menu-item');
            menuItems.forEach(item => {
                item.style.cssText = `
                    display: flex;
                    align-items: center;
                    gap: 10px;
                    padding: 10px 15px;
                    color: var(--light);
                    cursor: pointer;
                    transition: var(--transition);
                    font-size: 0.9rem;
                `;

                item.addEventListener('mouseenter', () => {
                    item.style.background = 'rgba(124, 58, 237, 0.1)';
                    item.style.color = 'var(--primary)';
                });

                item.addEventListener('mouseleave', () => {
                    item.style.background = 'transparent';
                    item.style.color = 'var(--light)';
                });
            });

            avatarElement.style.position = 'relative';
            avatarElement.appendChild(menu);

            // Animate in
            setTimeout(() => {
                menu.style.opacity = '1';
                menu.style.visibility = 'visible';
                menu.style.transform = 'translateX(-50%) translateY(0)';
            }, 10);

            // Close menu when clicking outside
            const closeMenu = (e) => {
                if (!avatarElement.contains(e.target)) {
                    menu.remove();
                    document.removeEventListener('click', closeMenu);
                }
            };

            setTimeout(() => {
                document.addEventListener('click', closeMenu);
            }, 100);
        }

        // Show profile menu
        function showProfileMenu() {
            const profileMenu = document.getElementById('profileMenu');
            if (!profileMenu) return;

            const isVisible = profileMenu.style.display === 'block';
            profileMenu.style.display = isVisible ? 'none' : 'block';

            // Update chevron direction
            const menuBtn = document.getElementById('profileMenuBtn');
            if (menuBtn) {
                const chevron = menuBtn.querySelector('i');
                if (chevron) {
                    chevron.className = isVisible ? 'fas fa-chevron-up' : 'fas fa-chevron-down';
                }
            }
        }

        // Switch account function
        function switchAccount() {
            console.log('🔄 Profile: Switching account...');
            showProfileMenu();

            // Show account switcher modal
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.8); display: flex; align-items: center;
                justify-content: center; z-index: 1000;
            `;

            modal.innerHTML = `
                <div style="background: var(--darker); padding: 30px; border-radius: 16px; max-width: 500px; width: 90%;">
                    <h3 style="color: var(--primary); margin-bottom: 20px;">Switch Account</h3>
                    <div style="margin-bottom: 20px;">
                        <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; margin-bottom: 15px; cursor: pointer;" onclick="selectAccount('main')">
                            <div style="color: var(--light); font-weight: 600;">Main Account</div>
                            <div style="color: var(--gray); font-size: 0.8rem;">0x071f6d5g9b4c8e3f0a7d2b6c9e1f4a5b8c0d3e6f7a9b1c4d5e8f9a2b3c6d7e0f1a4b5c8d9e2f3a6b7c0d1e4f5a8b9c2d3e6f7a0b1</div>
                        </div>
                        <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; margin-bottom: 15px; cursor: pointer;" onclick="selectAccount('staking')">
                            <div style="color: var(--light); font-weight: 600;">Staking Account</div>
                            <div style="color: var(--gray); font-size: 0.8rem;">0x058d4b9e3f7c2a8d1e6f5b9c0d3e2f1a4b5c6d7e8f9a0b1c2d3e4f5a6b7c8d9e0f1a2b3c4d5e6f7a8b9c0d1e2f3a4b5c6d7e8f9a0b1</div>
                        </div>
                        <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; cursor: pointer;" onclick="selectAccount('trading')">
                            <div style="color: var(--light); font-weight: 600;">Trading Account</div>
                            <div style="color: var(--gray); font-size: 0.8rem;">0x069e5c4f8a3b7d2e9f6c1a5b8d0e4f3c6b7a8d9e0f1a2b3c4d5e6f7a8b9c0d1e2f3a4b5c6d7e8f9a0b1c2d3e4f5a6b7c8d9e0f1a2</div>
                        </div>
                    </div>
                    <div style="display: flex; gap: 10px; justify-content: flex-end;">
                        <button onclick="this.parentElement.parentElement.remove()" style="background: rgba(255,255,255,0.1); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer;">Cancel</button>
                        <button onclick="connectNewWallet(); this.parentElement.parentElement.remove()" style="background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer;">Connect New</button>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);

            // Close modal when clicking outside
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // Select account
        function selectAccount(accountType) {
            console.log('🔄 Profile: Selecting account:', accountType);

            // Update user data based on account type
            const accounts = {
                main: {
                    address: '0x071f6d5g9b4c8e3f0a7d2b6c9e1f4a5b8c0d3e6f7a9b1c4d5e8f9a2b3c6d7e0f1a4b5c8d9e2f3a6b7c0d1e4f5a8b9c2d3e6f7a0b1',
                    name: 'Main Account'
                },
                staking: {
                    address: '0x058d4b9e3f7c2a8d1e6f5b9c0d3e2f1a4b5c6d7e8f9a0b1c2d3e4f5a6b7c8d9e0f1a2b3c4d5e6f7a8b9c0d1e2f3a4b5c6d7e8f9a0b1',
                    name: 'Staking Account'
                },
                trading: {
                    address: '0x069e5c4f8a3b7d2e9f6c1a5b8d0e4f3c6b7a8d9e0f1a2b3c4d5e6f7a8b9c0d1e2f3a4b5c6d7e8f9a0b1c2d3e4f5a6b7c8d9e0f1a2',
                    name: 'Trading Account'
                }
            };

            const account = accounts[accountType];
            if (account) {
                userData.walletAddress = account.address;
                userData.accountType = accountType;
                userData.name = account.name;
                localStorage.setItem('userData', JSON.stringify(userData));

                updateUserProfile();
                updateConnectionStatus('connected');

                // Close modal
                const modal = document.querySelector('div[style*="position: fixed"][style*="z-index: 1000"]');
                if (modal) {
                    modal.remove();
                }

                addNotification('Account Switched', `Switched to ${account.name}`, 'success');
            }
        }

        // Connect new wallet
        function connectNewWallet() {
            console.log('🔗 Profile: Connecting new wallet...');
            showProfileMenu();

            // Simulate wallet connection
            addNotification('Connecting Wallet', 'Opening wallet selection...', 'info');

            setTimeout(() => {
                const wallets = ['MetaMask', 'Argent X', 'Braavos'];
                const selectedWallet = wallets[Math.floor(Math.random() * wallets.length)];

                addNotification('Wallet Connected', `Connected to ${selectedWallet}`, 'success');

                // Update user data with new wallet
                userData.walletAddress = '0x0' + Math.random().toString(16).substring(2, 64);
                userData.walletType = selectedWallet;
                localStorage.setItem('userData', JSON.stringify(userData));

                updateUserProfile();
                updateConnectionStatus('connected');
            }, 2000);
        }

        // Manage wallets
        function manageWallets() {
            console.log('⚙️ Profile: Managing wallets...');
            showProfileMenu();

            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.8); display: flex; align-items: center;
                justify-content: center; z-index: 1000;
            `;

            modal.innerHTML = `
                <div style="background: var(--darker); padding: 30px; border-radius: 16px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto;">
                    <h3 style="color: var(--primary); margin-bottom: 20px;">Wallet Management</h3>

                    <div style="margin-bottom: 20px;">
                        <h4 style="color: var(--light); margin-bottom: 15px;">Connected Wallets</h4>
                        <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="color: var(--light); font-weight: 600;">MetaMask</div>
                                    <div style="color: var(--gray); font-size: 0.8rem;">0x071f6d5g9b4c8e3f0a7d2b6c9e1f4a5b8c0d3e6f7a9b1c4d5e8f9a2b3c6d7e0f1a4b5c8d9e2f3a6b7c0d1e4f5a8b9c2d3e6f7a0b1</div>
                                </div>
                                <div style="display: flex; gap: 10px;">
                                    <button onclick="setDefaultWallet('metamask')" style="background: var(--secondary); color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">Default</button>
                                    <button onclick="disconnectWallet('metamask')" style="background: var(--danger); color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">Disconnect</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <h4 style="color: var(--light); margin-bottom: 15px;">Available Wallets</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                            <div class="wallet-option" onclick="connectWallet('argent')">
                                <i class="fas fa-wallet"></i>
                                <span>Argent X</span>
                            </div>
                            <div class="wallet-option" onclick="connectWallet('braavos')">
                                <i class="fas fa-wallet"></i>
                                <span>Braavos</span>
                            </div>
                            <div class="wallet-option" onclick="connectWallet('metamask')">
                                <i class="fab fa-ethereum"></i>
                                <span>MetaMask</span>
                            </div>
                        </div>
                    </div>

                    <div style="display: flex; gap: 10px; justify-content: flex-end;">
                        <button onclick="this.parentElement.parentElement.remove()" style="background: rgba(255,255,255,0.1); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer;">Close</button>
                    </div>
                </div>
            `;

            // Add wallet option styles
            const walletOptions = modal.querySelectorAll('.wallet-option');
            walletOptions.forEach(option => {
                option.style.cssText = `
                    background: rgba(255,255,255,0.05);
                    padding: 15px;
                    border-radius: 8px;
                    text-align: center;
                    cursor: pointer;
                    transition: var(--transition);
                    border: 1px solid rgba(255,255,255,0.1);
                `;

                option.addEventListener('mouseenter', () => {
                    option.style.background = 'rgba(124, 58, 237, 0.1)';
                    option.style.borderColor = 'var(--primary)';
                });

                option.addEventListener('mouseleave', () => {
                    option.style.background = 'rgba(255,255,255,0.05)';
                    option.style.borderColor = 'rgba(255,255,255,0.1)';
                });
            });

            document.body.appendChild(modal);

            // Close modal when clicking outside
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // Connect wallet
        function connectWallet(walletType) {
            console.log('🔗 Profile: Connecting wallet:', walletType);

            addNotification('Connecting', `Connecting to ${walletType}...`, 'info');

            setTimeout(() => {
                const walletNames = {
                    argent: 'Argent X',
                    braavos: 'Braavos',
                    metamask: 'MetaMask'
                };

                addNotification('Connected', `Successfully connected to ${walletNames[walletType]}`, 'success');

                // Update user data
                userData.walletAddress = '0x0' + Math.random().toString(16).substring(2, 64);
                userData.walletType = walletNames[walletType];
                localStorage.setItem('userData', JSON.stringify(userData));

                updateUserProfile();
                updateConnectionStatus('connected');

                // Close modal
                const modal = document.querySelector('div[style*="position: fixed"][style*="z-index: 1000"]');
                if (modal) {
                    modal.remove();
                }
            }, 1500);
        }

        // Set default wallet
        function setDefaultWallet(walletId) {
            console.log('⭐ Profile: Setting default wallet:', walletId);
            addNotification('Default Wallet', `${walletId} set as default`, 'success');
        }

        // Disconnect wallet
        function disconnectWallet(walletId) {
            console.log('❌ Profile: Disconnecting wallet:', walletId);
            addNotification('Wallet Disconnected', `${walletId} has been disconnected`, 'info');
        }

        // Show profile settings
        function showProfileSettings() {
            console.log('⚙️ Profile: Showing profile settings...');
            showProfileMenu();

            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.8); display: flex; align-items: center;
                justify-content: center; z-index: 1000;
            `;

            modal.innerHTML = `
                <div style="background: var(--darker); padding: 30px; border-radius: 16px; max-width: 500px; width: 90%;">
                    <h3 style="color: var(--primary); margin-bottom: 20px;">Profile Settings</h3>
                    <form id="profileSettingsForm">
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; color: var(--light);">Display Name</label>
                            <input type="text" id="profileName" value="${userData.name || ''}" style="width: 100%; padding: 10px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: white;">
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; color: var(--light);">Email</label>
                            <input type="email" id="profileEmail" value="${userData.email || ''}" style="width: 100%; padding: 10px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: white;">
                        </div>
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 5px; color: var(--light);">Bio</label>
                            <textarea id="profileBio" placeholder="Tell us about yourself..." style="width: 100%; padding: 10px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: white; resize: vertical; min-height: 80px;">${userData.bio || ''}</textarea>
                        </div>
                        <div style="display: flex; gap: 10px; justify-content: flex-end;">
                            <button type="button" onclick="this.parentElement.parentElement.remove()" style="background: rgba(255,255,255,0.1); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer;">Cancel</button>
                            <button type="submit" style="background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer;">Save</button>
                        </div>
                    </form>
                </div>
            `;

            document.body.appendChild(modal);

            // Handle form submission
            document.getElementById('profileSettingsForm').addEventListener('submit', function(e) {
                e.preventDefault();

                // Update user data
                userData.name = document.getElementById('profileName').value;
                userData.email = document.getElementById('profileEmail').value;
                userData.bio = document.getElementById('profileBio').value;

                localStorage.setItem('userData', JSON.stringify(userData));
                updateUserProfile();

                modal.remove();
                addNotification('Profile Updated', 'Your profile has been saved', 'success');
            });

            // Close modal when clicking outside
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // Export profile data
        function exportProfileData() {
            console.log('📤 Profile: Exporting profile data...');
            showProfileMenu();

            const exportData = {
                timestamp: new Date().toISOString(),
                profile: userData,
                settings: userSettings,
                exportVersion: '1.0'
            };

            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `bitstark-profile-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            addNotification('Data Exported', 'Your profile data has been downloaded', 'success');
        }

        // Clear profile data
        function clearProfileData() {
            console.log('🗑️ Profile: Clearing profile data...');
            showProfileMenu();

            if (confirm('Are you sure you want to clear all profile data? This action cannot be undone.')) {
                // Clear user data
                userData = {
                    name: "User Name",
                    avatar: null,
                    email: "",
                    role: "user"
                };

                localStorage.removeItem('userData');
                updateUserProfile();
                updateConnectionStatus('disconnected');

                addNotification('Profile Cleared', 'All profile data has been removed', 'info');
            }
        }

        // Logout function
        function logout() {
            console.log('🚪 Profile: Logging out...');
            showProfileMenu();

            if (confirm('Are you sure you want to logout?')) {
                // Clear all user data
                localStorage.removeItem('userData');
                localStorage.removeItem('userSettings');

                // Reset to defaults
                userData = {
                    name: "User Name",
                    avatar: null,
                    email: "",
                    role: "user"
                };

                userSettings = {
                    theme: 'dark',
                    autoRefresh: true,
                    refreshInterval: 30,
                    notifications: {
                        enabled: true,
                        sound: false,
                        types: {
                            deposits: true,
                            withdrawals: true,
                            system: true,
                            operators: true
                        }
                    },
                    display: {
                        showCharts: false,
                        compactView: false,
                        animations: true
                    }
                };

                updateUserProfile();
                updateConnectionStatus('disconnected');

                addNotification('Logged Out', 'You have been logged out successfully', 'info');
            }
        }

        // Update connection status
        function updateConnectionStatus(status) {
            const indicator = document.getElementById('connectionIndicator');
            if (!indicator) return;

            indicator.className = 'connection-indicator';

            switch (status) {
                case 'connected':
                    indicator.classList.add('connected');
                    indicator.innerHTML = '<i class="fas fa-circle"></i>';
                    indicator.title = 'Wallet connected';
                    break;
                case 'connecting':
                    indicator.classList.add('connecting');
                    indicator.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                    indicator.title = 'Connecting to wallet...';
                    break;
                case 'disconnected':
                default:
                    indicator.innerHTML = '<i class="fas fa-circle"></i>';
                    indicator.title = 'Wallet disconnected';
                    break;
            }
        }

        // ==========================================
        // COMPLETE AVATAR SYSTEM REWRITE
        // ==========================================

        // Open image selector for avatar upload
        function openImageSelector() {
            console.log('🔍 Avatar: Opening image selector...');
            const fileInput = document.getElementById('avatarFileInput');
            if (fileInput) {
                fileInput.click();
                console.log('✅ Avatar: File input clicked');
            } else {
                console.error('❌ Avatar: File input not found');
                // Try to find and create it if missing
                createAvatarFileInput();
            }
        }

        // Create avatar file input if missing
        function createAvatarFileInput() {
            console.log('🔧 Avatar: Creating missing file input...');
            const existingInput = document.getElementById('avatarFileInput');
            if (existingInput) {
                console.log('✅ Avatar: File input already exists');
                return;
            }

            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.id = 'avatarFileInput';
            fileInput.accept = 'image/*';
            fileInput.style.display = 'none';
            fileInput.addEventListener('change', handleAvatarUpload);

            document.body.appendChild(fileInput);
            console.log('✅ Avatar: Created new file input');
        }

        // Handle avatar image selection with comprehensive error handling
        async function handleAvatarUpload(event) {
            const file = event.target.files[0];
            if (!file) {
                console.log('⚠️ Avatar: No file selected');
                return;
            }

            console.log('📁 Avatar: File selected:', {
                name: file.name,
                type: file.type,
                size: file.size,
                sizeMB: (file.size / (1024 * 1024)).toFixed(2)
            });

            try {
                // Validate the file
                validateImageFile(file);
                console.log('✅ Avatar: File validation passed');

                // Show loading state
                showAvatarLoadingState();

                // Compress image if needed
                let processedFile = file;
                if (file.size > 1024 * 1024) { // If larger than 1MB, compress
                    console.log('🗜️ Avatar: Compressing image...');
                    addNotification('Processing Image', 'Compressing image for optimal performance...', 'info');

                    const compressedBlob = await compressImage(file, 200, 0.8);
                    processedFile = new File([compressedBlob], file.name, { type: 'image/jpeg' });

                    console.log('✅ Avatar: Image compressed from', (file.size / 1024).toFixed(1), 'KB to', (processedFile.size / 1024).toFixed(1), 'KB');
                }

                // Convert to data URL
                const imageData = await readFileAsDataURL(processedFile);
                console.log('✅ Avatar: Image processed successfully, size:', imageData.length);

                // Update user data
                userData.avatar = imageData;
                localStorage.setItem('userData', JSON.stringify(userData));
                console.log('💾 Avatar: User data saved to localStorage');

                // Update the avatar display
                updateUserProfile();
                console.log('🎨 Avatar: Profile updated');

                // Show success notification with file size info
                const originalSize = (file.size / 1024).toFixed(1);
                const finalSize = (processedFile.size / 1024).toFixed(1);
                const sizeInfo = originalSize !== finalSize ? ` (${originalSize}KB → ${finalSize}KB)` : ` (${finalSize}KB)`;

                addNotification('Avatar Updated', `Profile picture updated successfully${sizeInfo}`, 'success');

            } catch (error) {
                console.error('❌ Avatar: Error processing file:', error);
                addNotification('Upload Error', error.message, 'error');
                hideAvatarLoadingState();
            }

            resetFileInput();
        }

        // Utility function to read file as data URL
        function readFileAsDataURL(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();

                reader.onload = function(e) {
                    resolve(e.target.result);
                };

                reader.onerror = function(error) {
                    reject(new Error('Failed to read file'));
                };

                reader.readAsDataURL(file);
            });
        }

        // Enhanced avatar management functions
        function showImagePreview(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => resolve(e.target.result);
                reader.onerror = (e) => reject(new Error('Failed to preview image'));
                reader.readAsDataURL(file);
            });
        }

        // Batch image operations
        function processMultipleImages(files) {
            const promises = Array.from(files).map(async (file) => {
                try {
                    validateImageFile(file);
                    const compressedBlob = await compressImage(file, 150, 0.7);
                    const processedFile = new File([compressedBlob], file.name, { type: 'image/jpeg' });
                    return await readFileAsDataURL(processedFile);
                } catch (error) {
                    console.error('Error processing file:', file.name, error);
                    return null;
                }
            });

            return Promise.all(promises);
        }

        // Clear avatar and reset to initials
        function clearAvatar() {
            console.log('🗑️ Avatar: Clearing avatar...');

            if (confirm('Are you sure you want to remove your profile picture?')) {
                userData.avatar = null;
                localStorage.setItem('userData', JSON.stringify(userData));

                updateUserProfile();
                addNotification('Avatar Removed', 'Profile picture has been removed', 'info');
            }
        }

        // Export avatar image
        function exportAvatar() {
            if (!userData.avatar) {
                addNotification('No Avatar', 'No profile picture to export', 'warning');
                return;
            }

            const link = document.createElement('a');
            link.href = userData.avatar;
            link.download = `profile-avatar-${new Date().toISOString().split('T')[0]}.jpg`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            addNotification('Avatar Exported', 'Profile picture downloaded', 'success');
        }

        // Reset file input
        function resetFileInput() {
            const fileInput = document.getElementById('avatarFileInput');
            if (fileInput) {
                fileInput.value = '';
            }
        }

        // Show loading state on avatar
        function showAvatarLoadingState() {
            const avatarElement = document.getElementById('userAvatar');
            if (avatarElement) {
                avatarElement.style.opacity = '0.7';
                avatarElement.style.filter = 'grayscale(50%)';

                // Add loading indicator
                let loadingIndicator = avatarElement.querySelector('.avatar-loading');
                if (!loadingIndicator) {
                    loadingIndicator = document.createElement('div');
                    loadingIndicator.className = 'avatar-loading';
                    loadingIndicator.style.cssText = `
                        position: absolute;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 100%;
                        background: rgba(0, 0, 0, 0.6);
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        color: white;
                        font-size: 1.2rem;
                        border-radius: 50%;
                        z-index: 10;
                    `;
                    loadingIndicator.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                    avatarElement.style.position = 'relative';
                    avatarElement.appendChild(loadingIndicator);
                }
            }
        }

        // Hide loading state
        function hideAvatarLoadingState() {
            const avatarElement = document.getElementById('userAvatar');
            if (avatarElement) {
                avatarElement.style.opacity = '1';
                avatarElement.style.filter = 'none';

                const loadingIndicator = avatarElement.querySelector('.avatar-loading');
                if (loadingIndicator) {
                    loadingIndicator.remove();
                }
            }
        }

        // Show picture selector
        function showPictureSelector() {
            console.log('🖼️ Profile: Showing picture selector...');

            const previewGrid = document.getElementById('picturePreviewGrid');
            if (!previewGrid) return;

            const isVisible = previewGrid.style.display === 'block';
            previewGrid.style.display = isVisible ? 'none' : 'block';

            if (!isVisible) {
                // Populate avatar options if not already done
                populateAvatarOptions();
            }
        }

        // Populate avatar options
        function populateAvatarOptions() {
            const grid = document.querySelector('.picture-preview-grid .avatar-option');
            if (grid && grid.parentNode.children.length > 1) {
                // Already populated
                return;
            }

            const avatarGrid = document.querySelector('.picture-preview-grid > div:last-child');
            if (!avatarGrid) return;

            // Clear existing options
            avatarGrid.innerHTML = '';

            // Avatar options with different styles
            const avatarOptions = [
                { type: 'initials', content: 'U', color: 'linear-gradient(135deg, var(--primary), var(--secondary))' },
                { type: 'initials', content: 'UN', color: 'linear-gradient(135deg, #ff6b6b, #ee5a24)' },
                { type: 'initials', content: 'UR', color: 'linear-gradient(135deg, #4ecdc4, #44a08d)' },
                { type: 'initials', content: 'US', color: 'linear-gradient(135deg, #a8edea, #fed6e3)' },
                { type: 'icon', content: 'fas fa-user', color: 'var(--primary)' },
                { type: 'icon', content: 'fas fa-user-circle', color: 'var(--secondary)' },
                { type: 'icon', content: 'fas fa-user-astronaut', color: '#ff6b6b' },
                { type: 'icon', content: 'fas fa-user-ninja', color: '#4ecdc4' },
                { type: 'emoji', content: '🚀', color: 'transparent' },
                { type: 'emoji', content: '💎', color: 'transparent' },
                { type: 'emoji', content: '⚡', color: 'transparent' },
                { type: 'emoji', content: '🔥', color: 'transparent' },
                { type: 'pattern', content: 'btc', color: 'var(--bitcoin-orange)' },
                { type: 'pattern', content: 'stark', color: 'var(--starknet-purple)' },
                { type: 'pattern', content: 'bridge', color: 'var(--primary)' },
                { type: 'pattern', content: 'wallet', color: 'var(--secondary)' }
            ];

            avatarOptions.forEach((option, index) => {
                const avatarOption = document.createElement('div');
                avatarOption.className = 'avatar-option';
                avatarOption.onclick = () => selectAvatarOption(option, index);

                if (option.type === 'initials') {
                    avatarOption.textContent = option.content;
                    avatarOption.style.background = option.color;
                    avatarOption.style.color = 'white';
                } else if (option.type === 'icon') {
                    avatarOption.innerHTML = `<i class="${option.content}"></i>`;
                    avatarOption.style.background = 'rgba(255,255,255,0.1)';
                    avatarOption.style.color = option.color;
                } else if (option.type === 'emoji') {
                    avatarOption.textContent = option.content;
                    avatarOption.style.background = option.color;
                    avatarOption.style.fontSize = '1.2rem';
                } else if (option.type === 'pattern') {
                    avatarOption.innerHTML = `<i class="fas fa-${option.content === 'btc' ? 'bitcoin' : option.content === 'stark' ? 'layer-group' : option.content === 'bridge' ? 'link' : 'wallet'}"></i>`;
                    avatarOption.style.background = option.color;
                    avatarOption.style.color = 'white';
                }

                avatarGrid.appendChild(avatarOption);
            });

            console.log('✅ Profile: Avatar options populated');
        }

        // Select avatar option
        function selectAvatarOption(option, index) {
            console.log('🎨 Profile: Selecting avatar option:', option);

            // Remove selected class from all options
            document.querySelectorAll('.avatar-option').forEach(opt => {
                opt.classList.remove('selected');
            });

            // Add selected class to chosen option
            const options = document.querySelectorAll('.avatar-option');
            if (options[index]) {
                options[index].classList.add('selected');
            }

            // Generate avatar data based on selection
            let avatarData = null;

            if (option.type === 'initials') {
                // Create SVG for initials
                const svg = `<svg width="100" height="100" xmlns="http://www.w3.org/2000/svg">
                    <rect width="100" height="100" fill="${option.color}"/>
                    <text x="50" y="55" font-family="Arial" font-size="40" fill="white" text-anchor="middle">${option.content}</text>
                </svg>`;
                avatarData = 'data:image/svg+xml;base64,' + btoa(svg);
            } else if (option.type === 'icon') {
                // Create SVG for icon
                const svg = `<svg width="100" height="100" xmlns="http://www.w3.org/2000/svg">
                    <rect width="100" height="100" fill="rgba(255,255,255,0.1)"/>
                    <text x="50" y="55" font-family="Font Awesome 6 Free" font-size="40" fill="${option.color}" text-anchor="middle">${option.content}</text>
                </svg>`;
                avatarData = 'data:image/svg+xml;base64,' + btoa(svg);
            } else if (option.type === 'emoji') {
                // For emojis, we'll use a simple colored background
                const svg = `<svg width="100" height="100" xmlns="http://www.w3.org/2000/svg">
                    <rect width="100" height="100" fill="${option.color}"/>
                    <text x="50" y="65" font-size="50" text-anchor="middle">${option.content}</text>
                </svg>`;
                avatarData = 'data:image/svg+xml;base64,' + btoa(svg);
            } else if (option.type === 'pattern') {
                // Create SVG for pattern
                const svg = `<svg width="100" height="100" xmlns="http://www.w3.org/2000/svg">
                    <rect width="100" height="100" fill="${option.color}"/>
                    <text x="50" y="55" font-family="Font Awesome 6 Free" font-size="40" fill="white" text-anchor="middle">${option.content}</text>
                </svg>`;
                avatarData = 'data:image/svg+xml;base64,' + btoa(svg);
            }

            if (avatarData) {
                // Update user data
                userData.avatar = avatarData;
                localStorage.setItem('userData', JSON.stringify(userData));

                // Update the avatar display
                updateUserProfile();

                // Hide the picture selector
                const previewGrid = document.getElementById('picturePreviewGrid');
                if (previewGrid) {
                    previewGrid.style.display = 'none';
                }

                addNotification('Avatar Updated', 'Your profile picture has been changed', 'success');
            }
        }

        // Hide picture selector
        function hidePictureSelector() {
            const previewGrid = document.getElementById('picturePreviewGrid');
            if (previewGrid) {
                previewGrid.style.display = 'none';
            }
        }

        // Initialize profile menu functionality
        function initializeProfileMenu() {
            console.log('🎯 Profile: Initializing profile menu...');

            // Add click outside handler for profile menu
            document.addEventListener('click', function(e) {
                const profileMenu = document.getElementById('profileMenu');
                const profileMenuBtn = document.getElementById('profileMenuBtn');
                const picturePreviewGrid = document.getElementById('picturePreviewGrid');

                // Handle profile menu
                if (profileMenu && !profileMenu.contains(e.target) && !profileMenuBtn.contains(e.target)) {
                    profileMenu.style.display = 'none';

                    // Reset chevron
                    const chevron = profileMenuBtn?.querySelector('i');
                    if (chevron) {
                        chevron.className = 'fas fa-chevron-up';
                    }
                }

                // Handle picture selector
                if (picturePreviewGrid && !picturePreviewGrid.contains(e.target) &&
                    !e.target.closest('.picture-selector') && picturePreviewGrid.style.display === 'block') {
                    picturePreviewGrid.style.display = 'none';
                }
            });

            // Add escape key handler
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    const profileMenu = document.getElementById('profileMenu');
                    const picturePreviewGrid = document.getElementById('picturePreviewGrid');

                    // Close profile menu
                    if (profileMenu && profileMenu.style.display === 'block') {
                        profileMenu.style.display = 'none';

                        const profileMenuBtn = document.getElementById('profileMenuBtn');
                        const chevron = profileMenuBtn?.querySelector('i');
                        if (chevron) {
                            chevron.className = 'fas fa-chevron-up';
                        }
                    }

                    // Close picture selector
                    if (picturePreviewGrid && picturePreviewGrid.style.display === 'block') {
                        picturePreviewGrid.style.display = 'none';
                    }
                }
            });

            console.log('✅ Profile: Profile menu initialized');
        }

        // Initialize avatar upload functionality
        function initializeAvatarUpload() {
            console.log('🚀 Avatar: Initializing avatar system...');

            // Ensure file input exists
            createAvatarFileInput();

            const fileInput = document.getElementById('avatarFileInput');
            if (fileInput) {
                // Remove existing event listeners to prevent duplicates
                fileInput.removeEventListener('change', handleAvatarUpload);
                // Add fresh event listener
                fileInput.addEventListener('change', handleAvatarUpload);

                console.log('✅ Avatar: Upload functionality initialized');
                console.log('📋 Avatar: File input details:', {
                    id: fileInput.id,
                    type: fileInput.type,
                    accept: fileInput.accept,
                    hasEventListener: true
                });
            } else {
                console.error('❌ Avatar: Failed to create file input');
            }

            // Initialize drag and drop functionality
            initializeDragAndDrop();
        }

        // Initialize drag and drop functionality
        function initializeDragAndDrop() {
            const avatarElement = document.getElementById('userAvatar');
            if (!avatarElement) return;

            // Create drop zone overlay
            const dropZone = document.createElement('div');
            dropZone.className = 'file-upload-area';
            dropZone.id = 'avatarDropZone';
            dropZone.innerHTML = `
                <div style="color: var(--gray); font-size: 0.9rem;">
                    <i class="fas fa-cloud-upload-alt" style="font-size: 2rem; margin-bottom: 10px; display: block;"></i>
                    <div>Drop image here</div>
                    <div style="font-size: 0.8rem; margin-top: 5px;">or click to browse</div>
                </div>
            `;

            // Add drag and drop event listeners
            dropZone.addEventListener('click', () => {
                openImageSelector();
            });

            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                e.stopPropagation();
                dropZone.classList.add('dragover');
            });

            dropZone.addEventListener('dragleave', (e) => {
                e.preventDefault();
                e.stopPropagation();
                dropZone.classList.remove('dragover');
            });

            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                e.stopPropagation();
                dropZone.classList.remove('dragover');

                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    const file = files[0];
                    if (file.type.startsWith('image/')) {
                        // Create a synthetic event to reuse existing upload logic
                        const syntheticEvent = {
                            target: {
                                files: [file]
                            }
                        };
                        handleAvatarUpload(syntheticEvent);
                    } else {
                        addNotification('Invalid File Type', 'Please drop an image file', 'error');
                    }
                }
            });

            // Initially hide drop zone
            dropZone.style.display = 'none';
            dropZone.style.position = 'absolute';
            dropZone.style.top = '0';
            dropZone.style.left = '0';
            dropZone.style.width = '100%';
            dropZone.style.height = '100%';
            dropZone.style.borderRadius = '50%';
            dropZone.style.zIndex = '5';

            avatarElement.style.position = 'relative';
            avatarElement.appendChild(dropZone);

            // Show drop zone on hover
            avatarElement.addEventListener('mouseenter', () => {
                if (dropZone.style.display === 'none') {
                    dropZone.style.display = 'flex';
                    dropZone.style.alignItems = 'center';
                    dropZone.style.justifyContent = 'center';
                    dropZone.style.flexDirection = 'column';
                }
            });

            avatarElement.addEventListener('mouseleave', () => {
                dropZone.style.display = 'none';
                dropZone.classList.remove('dragover');
            });

            console.log('✅ Avatar: Drag and drop initialized');
        }

        // Enhanced file validation
        function validateImageFile(file) {
            const maxSize = 5 * 1024 * 1024; // 5MB
            const allowedTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp'];

            if (!allowedTypes.includes(file.type)) {
                throw new Error('Invalid file type. Please select a JPEG, PNG, GIF, or WebP image.');
            }

            if (file.size > maxSize) {
                throw new Error('File size too large. Please select an image smaller than 5MB.');
            }

            return true;
        }

        // Image compression utility
        function compressImage(file, maxWidth = 200, quality = 0.8) {
            return new Promise((resolve, reject) => {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                const img = new Image();

                img.onload = () => {
                    // Calculate new dimensions
                    let { width, height } = img;

                    if (width > maxWidth) {
                        height = (height * maxWidth) / width;
                        width = maxWidth;
                    }

                    canvas.width = width;
                    canvas.height = height;

                    // Draw and compress
                    ctx.drawImage(img, 0, 0, width, height);

                    canvas.toBlob(resolve, 'image/jpeg', quality);
                };

                img.onerror = reject;
                img.src = URL.createObjectURL(file);
            });
        }

        // Test avatar functionality
        function testAvatarFunctionality() {
            console.log('🧪 Avatar: Running comprehensive test...');

            // Test 1: Check if elements exist
            const avatarElement = document.getElementById('userAvatar');
            const fileInput = document.getElementById('avatarFileInput');

            if (!avatarElement) {
                console.error('❌ Avatar: Avatar element not found');
                return false;
            }

            if (!fileInput) {
                console.error('❌ Avatar: File input not found');
                return false;
            }

            console.log('✅ Avatar: All elements found');

            // Test 2: Test click functionality
            console.log('🖱️ Avatar: Testing click functionality...');
            try {
                fileInput.click();
                console.log('✅ Avatar: Click test passed');
            } catch (error) {
                console.error('❌ Avatar: Click test failed:', error);
                return false;
            }

            // Test 3: Test avatar update
            console.log('🎨 Avatar: Testing avatar update...');
            try {
                // Create a small test image
                const testImageData = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iIzdjM2FlZCIvPjx0ZXh0IHg9IjUwIiB5PSI1NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjQwIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+VDwvdGV4dD48L3N2Zz4=';

                userData.avatar = testImageData;
                localStorage.setItem('userData', JSON.stringify(userData));
                updateUserProfile();

                console.log('✅ Avatar: Update test completed');
                return true;

            } catch (error) {
                console.error('❌ Avatar: Update test failed:', error);
                return false;
            }
        }

        // Debug avatar system
        function debugAvatarSystem() {
            console.log('🔍 AVATAR DEBUG INFO:');
            console.log('==================');

            const avatarElement = document.getElementById('userAvatar');
            const avatarInitials = document.getElementById('avatarInitials');
            const avatarOverlay = document.getElementById('avatarOverlay');
            const fileInput = document.getElementById('avatarFileInput');

            console.log('Avatar Element:', avatarElement);
            console.log('Avatar Initials:', avatarInitials);
            console.log('Avatar Overlay:', avatarOverlay);
            console.log('File Input:', fileInput);
            console.log('User Data:', userData);
            console.log('Has Avatar Data:', !!userData.avatar);

            if (avatarElement) {
                console.log('Avatar children:', avatarElement.children.length);
                Array.from(avatarElement.children).forEach((child, index) => {
                    console.log(`  Child ${index}:`, child.tagName, child.className);
                });
            }

            // Test click functionality
            console.log('🧪 Testing avatar click...');
            if (avatarElement) {
                avatarElement.click();
            }
        }

        // Force avatar refresh
        function forceAvatarRefresh() {
            console.log('🔄 Avatar: Force refreshing avatar...');
            updateUserProfile();
        }

        // Test function to verify avatar functionality
        function testAvatarUpdate() {
            console.log('Testing avatar update...');
            console.log('Current userData:', userData);

            // Create a test image data URL (1x1 pixel transparent image)
            const testImageData = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==';

            userData.avatar = testImageData;
            localStorage.setItem('userData', JSON.stringify(userData));

            updateUserProfile();
            console.log('Test avatar applied');
        }

        // Update user profile in sidebar with bulletproof implementation
        function updateUserProfile() {
            console.log('🎨 Profile: Updating user profile...');

            try {
                // Update basic user info
                const userNameElement = document.getElementById('userName');
                const userRoleElement = document.getElementById('userRole');
                const userAddressElement = document.getElementById('userAddress');

                if (userNameElement) {
                    userNameElement.textContent = userData.name || 'User Name';
                }

                if (userRoleElement) {
                    const roleText = userData.role ?
                        userData.role.charAt(0).toUpperCase() + userData.role.slice(1) :
                        'Registered User';

                    // Add wallet type if available
                    if (userData.walletType) {
                        userRoleElement.textContent = `${roleText} • ${userData.walletType}`;
                    } else {
                        userRoleElement.textContent = roleText;
                    }
                }

                // Update wallet address display
                if (userAddressElement) {
                    if (userData.walletAddress) {
                        const shortAddress = userData.walletAddress.length > 20 ?
                            userData.walletAddress.substring(0, 10) + '...' + userData.walletAddress.substring(userData.walletAddress.length - 8) :
                            userData.walletAddress;
                        userAddressElement.textContent = shortAddress;
                        userAddressElement.title = userData.walletAddress; // Full address on hover
                    } else {
                        userAddressElement.textContent = '';
                    }
                }

                // Update avatar
                updateAvatarDisplay();

                console.log('✅ Profile: Profile update completed');

            } catch (error) {
                console.error('❌ Profile: Error updating profile:', error);
            }
        }

        // Dedicated avatar display update function
        function updateAvatarDisplay() {
            const avatarElement = document.getElementById('userAvatar');
            const avatarInitials = document.getElementById('avatarInitials');
            const avatarOverlay = document.getElementById('avatarOverlay');

            if (!avatarElement) {
                console.error('❌ Avatar: Avatar element not found');
                return;
            }

            console.log('🎨 Avatar: Updating avatar display, has avatar data:', !!userData.avatar);

            if (userData.avatar) {
                // Hide initials first
                if (avatarInitials) {
                    avatarInitials.style.display = 'none';
                }

                // Remove any existing images to prevent conflicts
                const existingImages = avatarElement.querySelectorAll('img');
                existingImages.forEach(img => img.remove());

                // Create new image element
                const avatarImg = document.createElement('img');
                avatarImg.alt = userData.name || 'User Avatar';
                avatarImg.style.cssText = `
                    width: 100%;
                    height: 100%;
                    object-fit: cover;
                    border-radius: 50%;
                    display: block;
                    position: absolute;
                    top: 0;
                    left: 0;
                    z-index: 1;
                `;

                // Set up event handlers before setting src
                avatarImg.onload = function() {
                    console.log('✅ Avatar: Image loaded successfully');
                    hideAvatarLoadingState();

                    // Ensure initials are hidden
                    if (avatarInitials) {
                        avatarInitials.style.display = 'none';
                    }

                    // Ensure overlay is visible
                    if (avatarOverlay) {
                        avatarOverlay.style.display = 'block';
                    }
                };

                avatarImg.onerror = function() {
                    console.error('❌ Avatar: Failed to load image, falling back to initials');
                    hideAvatarLoadingState();

                    // Show initials if image fails
                    if (avatarInitials) {
                        const names = (userData.name || 'User').split(' ');
                        let initials = names[0].charAt(0);
                        if (names.length > 1) {
                            initials += names[names.length - 1].charAt(0);
                        }
                        avatarInitials.textContent = initials.toUpperCase();
                        avatarInitials.style.display = 'flex';
                    }

                    // Remove failed image
                    if (avatarImg && avatarImg.parentNode) {
                        avatarImg.remove();
                    }
                };

                // Set the source to trigger loading
                avatarImg.src = userData.avatar;

                // Add image to avatar element
                avatarElement.appendChild(avatarImg);

                console.log('✅ Avatar: New image element created and added');

            } else {
                // No avatar data - show initials
                console.log('📝 Avatar: No avatar data, showing initials');

                // Remove any existing images
                const existingImages = avatarElement.querySelectorAll('img');
                existingImages.forEach(img => img.remove());

                // Show initials
                if (avatarInitials) {
                    const names = (userData.name || 'User').split(' ');
                    let initials = names[0].charAt(0);
                    if (names.length > 1) {
                        initials += names[names.length - 1].charAt(0);
                    }
                    avatarInitials.textContent = initials.toUpperCase();
                    avatarInitials.style.display = 'flex';
                }

                // Hide overlay when no avatar
                if (avatarOverlay) {
                    avatarOverlay.style.display = 'none';
                }
            }
        }

        // Fetch Bitcoin network data
        async function fetchBitcoinData() {
            const bitcoinCard = document.querySelector('.stat-card:nth-child(1)');
            const bitcoinValueElement = bitcoinCard?.querySelector('.stat-value');
            const changeElement = bitcoinCard?.querySelector('.stat-change');

            // Show loading state
            if (bitcoinValueElement) {
                bitcoinValueElement.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
            }

            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 10000); // 10 second timeout

                const response = await fetch('https://blockchain.info/q/getblockcount', {
                    signal: controller.signal
                });
                clearTimeout(timeoutId);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const blockHeight = await response.text();
                const height = parseInt(blockHeight);

                if (isNaN(height)) {
                    throw new Error('Invalid block height received');
                }

                // Update Bitcoin height
                if (bitcoinValueElement) {
                    bitcoinValueElement.textContent = height.toLocaleString();
                }

                // Update change indicator with simulated change
                if (changeElement) {
                    const change = Math.floor(Math.random() * 200) + 50;
                    changeElement.innerHTML = `<i class="fas fa-arrow-up"></i> +${change} blocks`;
                    changeElement.className = 'stat-change positive';
                }

                // Remove any existing error messages
                const existingError = bitcoinCard?.querySelector('.error-message');
                if (existingError) {
                    existingError.remove();
                }

            } catch (error) {
                console.error('Error fetching Bitcoin data:', error);

                // Show error state
                if (bitcoinValueElement) {
                    bitcoinValueElement.innerHTML = '<i class="fas fa-exclamation-triangle"></i>';
                }

                if (changeElement) {
                    changeElement.innerHTML = '<i class="fas fa-exclamation-circle"></i> Error';
                    changeElement.className = 'stat-change negative';
                }

                // Send error notification
                addNotification('Data Fetch Error', 'Failed to fetch Bitcoin network data', 'error');
            }
        }

        // Fetch Starknet data (simulated since public APIs may be limited)
        async function fetchStarknetData() {
            try {
                // Simulate Starknet data - in real implementation, use Starknet APIs
                const starknetHeight = Math.floor(Math.random() * 100) + 788400;

                const starknetHeightElement = document.querySelector('.stat-card:nth-child(2) .stat-value');
                if (starknetHeightElement) {
                    starknetHeightElement.textContent = starknetHeight.toLocaleString();
                }

                // Update SPV proofs count
                const proofsElement = document.querySelector('.stat-card:nth-child(3) .stat-value');
                if (proofsElement) {
                    const currentProofs = parseInt(proofsElement.textContent.replace(/,/g, ''));
                    const newProofs = currentProofs + Math.floor(Math.random() * 10);
                    proofsElement.textContent = newProofs.toLocaleString();
                }
            } catch (error) {
                console.error('Error fetching Starknet data:', error);
            }
        }

        // Fetch system data
        function fetchSystemData() {
            // Update operator count
            const operatorElement = document.querySelector('.stat-card:nth-child(4) .stat-value');
            if (operatorElement) {
                const online = Math.floor(Math.random() * 3) + 4;
                const total = 7;
                operatorElement.textContent = `${online}/${total}`;
            }

            // Update progress bars
            updateProgressBars();
        }

        // Update progress bars with dynamic values
        function updateProgressBars() {
            // Bitcoin sync
            const bitcoinProgress = document.querySelector('.progress-fill');
            if (bitcoinProgress) {
                bitcoinProgress.style.width = '100%';
                document.querySelector('.progress-value').textContent = '100%';
            }

            // Proof construction
            const proofProgress = document.querySelectorAll('.progress-fill')[1];
            if (proofProgress) {
                const proofValue = Math.floor(Math.random() * 30) + 50;
                proofProgress.style.width = proofValue + '%';
                const proofValueElement = document.querySelectorAll('.progress-value')[1];
                if (proofValueElement) {
                    proofValueElement.textContent = proofValue + '%';
                }
            }

            // Starknet submission
            const starknetProgress = document.querySelectorAll('.progress-fill')[2];
            if (starknetProgress) {
                const starknetValue = Math.floor(Math.random() * 40) + 30;
                starknetProgress.style.width = starknetValue + '%';
                const starknetValueElement = document.querySelectorAll('.progress-value')[2];
                if (starknetValueElement) {
                    starknetValueElement.textContent = starknetValue + '%';
                }
            }
        }

        // Fetch transaction data
        function fetchTransactionData() {
            // Simulate fetching new transaction data
            updateDepositTable();
            updateWithdrawalTable();
        }

        // Update deposit table with dynamic data
        function updateDepositTable() {
            const tbody = document.querySelector('.table tbody');
            if (!tbody) return;

            // Simulate new deposits
            const deposits = [
                { id: 'DEP-' + (7832 + Math.floor(Math.random() * 10)), amount: (Math.random() * 2).toFixed(2), status: 'completed', time: '2 hours ago' },
                { id: 'DEP-' + (7831 + Math.floor(Math.random() * 10)), amount: (Math.random() * 2).toFixed(2), status: 'processing', time: '3 hours ago' },
                { id: 'DEP-' + (7830 + Math.floor(Math.random() * 10)), amount: (Math.random() * 2).toFixed(2), status: 'pending', time: '5 hours ago' },
                { id: 'DEP-' + (7829 + Math.floor(Math.random() * 10)), amount: (Math.random() * 2).toFixed(2), status: 'failed', time: '8 hours ago' }
            ];

            tbody.innerHTML = deposits.map(deposit => `
                <tr>
                    <td>${deposit.id}</td>
                    <td>${deposit.amount} BTC</td>
                    <td>
                        <span class="status-badge status-${deposit.status}">
                            <i class="fas fa-${deposit.status === 'completed' ? 'check-circle' : deposit.status === 'processing' ? 'spinner fa-spin' : deposit.status === 'pending' ? 'clock' : 'exclamation-circle'}"></i>
                            ${deposit.status === 'processing' ? 'Building Proof' : deposit.status === 'pending' ? 'Waiting for Confirmations' : deposit.status === 'failed' ? 'Invalid Tx' : 'Completed'}
                        </span>
                    </td>
                    <td>${deposit.time}</td>
                </tr>
            `).join('');
        }

        // Update withdrawal table
        function updateWithdrawalTable() {
            const withdrawalTbody = document.querySelectorAll('.table tbody')[1];
            if (!withdrawalTbody) return;

            const withdrawals = [
                { id: 'WD-' + (4521 + Math.floor(Math.random() * 10)), amount: (Math.random() * 2).toFixed(2), status: 'processing' },
                { id: 'WD-' + (4520 + Math.floor(Math.random() * 10)), amount: (Math.random() * 2).toFixed(2), status: 'pending' },
                { id: 'WD-' + (4519 + Math.floor(Math.random() * 10)), amount: (Math.random() * 2).toFixed(2), status: 'completed' }
            ];

            withdrawalTbody.innerHTML = withdrawals.map(withdrawal => `
                <tr>
                    <td>${withdrawal.id}</td>
                    <td>${withdrawal.amount} BTC</td>
                    <td>
                        <span class="status-badge status-${withdrawal.status}">
                            <i class="fas fa-${withdrawal.status === 'completed' ? 'check-circle' : withdrawal.status === 'processing' ? 'spinner fa-spin' : 'clock'}"></i>
                            ${withdrawal.status === 'processing' ? 'Signing' : withdrawal.status === 'pending' ? 'Awaiting Signatures' : 'Completed'}
                        </span>
                    </td>
                </tr>
            `).join('');
        }

        // Update transaction statuses in real-time
        function updateTransactionStatuses() {
            const statusBadges = document.querySelectorAll('.status-badge');
            statusBadges.forEach(badge => {
                if (badge.classList.contains('status-pending')) {
                    if (Math.random() > 0.7) {
                        badge.classList.remove('status-pending');
                        badge.classList.add('status-processing');
                        badge.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Building Proof';
                    }
                } else if (badge.classList.contains('status-processing')) {
                    if (Math.random() > 0.8) {
                        badge.classList.remove('status-processing');
                        badge.classList.add('status-completed');
                        badge.innerHTML = '<i class="fas fa-check-circle"></i> Completed';
                    }
                }
            });
        }

        // Chart variables
        let systemChart, transactionChart, networkChart;
        let chartData = {
            cpu: [],
            memory: [],
            disk: [],
            timestamps: [],
            transactions: [],
            network: []
        };

        // Initialize charts
        function initializeCharts() {
            const systemCtx = document.getElementById('systemChart');
            const transactionCtx = document.getElementById('transactionChart');
            const networkCtx = document.getElementById('networkChart');

            if (systemCtx) {
                systemChart = new Chart(systemCtx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'CPU %',
                            data: [],
                            borderColor: 'var(--info)',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            tension: 0.4,
                            fill: true
                        }, {
                            label: 'Memory %',
                            data: [],
                            borderColor: 'var(--warning)',
                            backgroundColor: 'rgba(245, 158, 11, 0.1)',
                            tension: 0.4,
                            fill: true
                        }, {
                            label: 'Disk %',
                            data: [],
                            borderColor: 'var(--danger)',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: {
                                    color: 'var(--light)',
                                    font: { size: 10 }
                                }
                            }
                        },
                        scales: {
                            x: {
                                ticks: { color: 'var(--gray)' },
                                grid: { color: 'rgba(255,255,255,0.1)' }
                            },
                            y: {
                                ticks: { color: 'var(--gray)' },
                                grid: { color: 'rgba(255,255,255,0.1)' }
                            }
                        }
                    }
                });
            }

            if (transactionCtx) {
                transactionChart = new Chart(transactionCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Deposits', 'Withdrawals', 'Pending', 'Completed'],
                        datasets: [{
                            label: 'Count',
                            data: [],
                            backgroundColor: [
                                'rgba(124, 58, 237, 0.6)',
                                'rgba(16, 185, 129, 0.6)',
                                'rgba(245, 158, 11, 0.6)',
                                'rgba(59, 130, 246, 0.6)'
                            ],
                            borderColor: [
                                'var(--primary)',
                                'var(--secondary)',
                                'var(--warning)',
                                'var(--info)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: { color: 'var(--gray)' },
                                grid: { color: 'rgba(255,255,255,0.1)' }
                            },
                            x: {
                                ticks: { color: 'var(--gray)' },
                                grid: { color: 'rgba(255,255,255,0.1)' }
                            }
                        }
                    }
                });
            }

            if (networkCtx) {
                networkChart = new Chart(networkCtx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'Bitcoin Blocks',
                            data: [],
                            borderColor: '#f7931a',
                            backgroundColor: 'rgba(247, 147, 26, 0.1)',
                            tension: 0.4,
                            fill: true
                        }, {
                            label: 'Starknet Headers',
                            data: [],
                            borderColor: 'var(--primary)',
                            backgroundColor: 'rgba(124, 58, 237, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: {
                                    color: 'var(--light)',
                                    font: { size: 10 }
                                }
                            }
                        },
                        scales: {
                            x: {
                                ticks: { color: 'var(--gray)' },
                                grid: { color: 'rgba(255,255,255,0.1)' }
                            },
                            y: {
                                ticks: { color: 'var(--gray)' },
                                grid: { color: 'rgba(255,255,255,0.1)' }
                            }
                        }
                    }
                });
            }
        }

        // Toggle charts visibility
        function toggleCharts() {
            const chartsSection = document.getElementById('chartsSection');
            const toggleText = document.getElementById('chartToggleText');
            const toggleBtn = document.querySelector('[onclick="toggleCharts()"]');

            if (chartsSection.style.display === 'none') {
                // Show charts
                chartsSection.style.display = 'block';
                toggleText.textContent = 'Hide Charts';

                // Initialize charts if not already done
                if (!systemChart) {
                    toggleBtn.disabled = true;
                    toggleBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading Charts...';

                    try {
                        initializeCharts();
                        updateCharts();
                        toggleBtn.disabled = false;
                        toggleBtn.innerHTML = '<i class="fas fa-chart-line"></i> <span id="chartToggleText">Hide Charts</span>';
                    } catch (error) {
                        console.error('Error initializing charts:', error);
                        chartsSection.style.display = 'none';
                        toggleText.textContent = 'Show Charts';
                        toggleBtn.disabled = false;
                        toggleBtn.innerHTML = '<i class="fas fa-exclamation-triangle"></i> <span id="chartToggleText">Show Charts</span>';

                        addNotification('Chart Error', 'Failed to load charts', 'error');
                    }
                }
            } else {
                // Hide charts
                chartsSection.style.display = 'none';
                toggleText.textContent = 'Show Charts';
            }
        }

        // Update charts with new data
        function updateCharts() {
            if (!systemChart || !transactionChart || !networkChart) return;

            const now = new Date();
            const timeString = now.getHours() + ':' + now.getMinutes().toString().padStart(2, '0');

            // Update system chart
            if (chartData.timestamps.length >= 24) {
                chartData.timestamps.shift();
                chartData.cpu.shift();
                chartData.memory.shift();
                chartData.disk.shift();
            }

            chartData.timestamps.push(timeString);
            chartData.cpu.push(Math.floor(Math.random() * 30) + 30);
            chartData.memory.push(Math.floor(Math.random() * 20) + 50);
            chartData.disk.push(Math.floor(Math.random() * 10) + 70);

            systemChart.data.labels = chartData.timestamps;
            systemChart.data.datasets[0].data = chartData.cpu;
            systemChart.data.datasets[1].data = chartData.memory;
            systemChart.data.datasets[2].data = chartData.disk;
            systemChart.update();

            // Update transaction chart
            const deposits = Math.floor(Math.random() * 50) + 20;
            const withdrawals = Math.floor(Math.random() * 30) + 10;
            const pending = Math.floor(Math.random() * 20) + 5;
            const completed = deposits + withdrawals - pending;

            transactionChart.data.datasets[0].data = [deposits, withdrawals, pending, completed];
            transactionChart.update();

            // Update network chart
            if (chartData.network.length >= 24) {
                chartData.network.shift();
            }
            chartData.network.push(Math.floor(Math.random() * 100) + 788400);

            networkChart.data.labels = chartData.timestamps;
            networkChart.data.datasets[0].data = chartData.network;
            networkChart.data.datasets[1].data = chartData.network.map(h => h - Math.floor(Math.random() * 100));
            networkChart.update();
        }

        // Update system resources
        function updateSystemResources() {
            // CPU usage
            const cpuValue = Math.floor(Math.random() * 30) + 30;
            const cpuBar = document.getElementById('cpuBar');
            const cpuValueElement = document.getElementById('cpuValue');
            if (cpuBar && cpuValueElement) {
                cpuBar.style.width = cpuValue + '%';
                cpuValueElement.textContent = cpuValue + '%';
            }

            // Memory usage
            const memValue = Math.floor(Math.random() * 20) + 50;
            const memBar = document.getElementById('memBar');
            const memValueElement = document.getElementById('memValue');
            if (memBar && memValueElement) {
                memBar.style.width = memValue + '%';
                memValueElement.textContent = memValue + '%';
            }

            // Disk usage
            const diskValue = Math.floor(Math.random() * 10) + 70;
            const diskBar = document.getElementById('diskBar');
            const diskValueElement = document.getElementById('diskValue');
            if (diskBar && diskValueElement) {
                diskBar.style.width = diskValue + '%';
                diskValueElement.textContent = diskValue + '%';
            }

            // Update charts if visible
            if (document.getElementById('chartsSection').style.display !== 'none') {
                updateCharts();
            }
        }

        // Apply filters to tables
        function applyFilters() {
            const searchTerm = document.getElementById('searchInput')?.value.toLowerCase() || '';
            const statusFilter = document.getElementById('statusFilter')?.value || 'all';
            const timeFilter = document.getElementById('timeFilter')?.value || 'all';

            const rows = document.querySelectorAll('.table tbody tr');
            rows.forEach(row => {
                let show = true;

                // Search filter
                if (searchTerm) {
                    const cells = row.querySelectorAll('td');
                    const rowText = Array.from(cells).map(cell => cell.textContent.toLowerCase()).join(' ');
                    if (!rowText.includes(searchTerm)) {
                        show = false;
                    }
                }

                // Status filter
                if (statusFilter !== 'all' && show) {
                    const statusBadge = row.querySelector('.status-badge');
                    if (statusBadge) {
                        const status = statusBadge.classList.contains('status-completed') ? 'completed' :
                                      statusBadge.classList.contains('status-processing') ? 'processing' :
                                      statusBadge.classList.contains('status-pending') ? 'pending' : 'failed';
                        if (status !== statusFilter) {
                            show = false;
                        }
                    }
                }

                row.style.display = show ? '' : 'none';
            });

            // Update result count
            updateResultCount();
        }

        // Update result count
        function updateResultCount() {
            const visibleRows = document.querySelectorAll('.table tbody tr:not([style*="display: none"])');
            const totalRows = document.querySelectorAll('.table tbody tr');
            const resultText = `${visibleRows.length} of ${totalRows.length} transactions`;

            // Add result count display if it doesn't exist
            let resultCount = document.getElementById('resultCount');
            if (!resultCount) {
                const filterBar = document.querySelector('.filter-bar');
                if (filterBar) {
                    resultCount = document.createElement('div');
                    resultCount.id = 'resultCount';
                    resultCount.style.cssText = 'color: var(--gray); font-size: 0.8rem; margin-top: 10px;';
                    filterBar.appendChild(resultCount);
                }
            }

            if (resultCount) {
                resultCount.textContent = resultText;
            }
        }

        // Show new transaction modal
        function showNewTransactionModal() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.8); display: flex; align-items: center;
                justify-content: center; z-index: 1000;
            `;
            modal.innerHTML = `
                <div style="background: var(--darker); padding: 30px; border-radius: 16px; max-width: 500px; width: 90%;">
                    <h3 style="color: var(--primary); margin-bottom: 20px;">New Transaction</h3>
                    <form id="newTxForm">
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; color: var(--light);">Transaction Type</label>
                            <select id="txType" style="width: 100%; padding: 10px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: white;">
                                <option value="deposit">Deposit (BTC → sBTC)</option>
                                <option value="withdrawal">Withdrawal (sBTC → BTC)</option>
                            </select>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; color: var(--light);">Amount (BTC)</label>
                            <input type="number" id="txAmount" step="0.00000001" min="0.00000001" placeholder="0.00000000" style="width: 100%; padding: 10px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: white;">
                            <small id="amountError" style="color: var(--danger); display: none;">Please enter a valid amount</small>
                        </div>
                        <div style="margin-bottom: 15px;" id="recipientField">
                            <label style="display: block; margin-bottom: 5px; color: var(--light);">Recipient Address</label>
                            <input type="text" id="recipientAddress" placeholder="Bitcoin address or Starknet address" style="width: 100%; padding: 10px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: white;">
                            <small id="addressError" style="color: var(--danger); display: none;">Please enter a valid address</small>
                        </div>
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 5px; color: var(--light);">
                                <input type="checkbox" id="confirmTx" style="margin-right: 8px;"> I confirm this transaction
                            </label>
                            <small id="confirmError" style="color: var(--danger); display: none;">Please confirm the transaction</small>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button type="submit" id="submitTxBtn" style="flex: 1; background: var(--primary); color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer;">Create Transaction</button>
                            <button type="button" onclick="this.parentElement.parentElement.parentElement.remove()" style="background: rgba(255,255,255,0.1); color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer;">Cancel</button>
                        </div>
                    </form>
                </div>
            `;
            document.body.appendChild(modal);

            // Dynamic form updates
            const txTypeSelect = document.getElementById('txType');
            const recipientField = document.getElementById('recipientField');
            const recipientInput = document.getElementById('recipientAddress');

            txTypeSelect.addEventListener('change', function() {
                if (this.value === 'deposit') {
                    recipientField.querySelector('label').textContent = 'Bitcoin Deposit Address';
                    recipientInput.placeholder = 'Your Bitcoin address for deposit';
                } else {
                    recipientField.querySelector('label').textContent = 'Bitcoin Withdrawal Address';
                    recipientInput.placeholder = 'Bitcoin address to receive withdrawal';
                }
            });

            // Handle form submission
            document.getElementById('newTxForm').addEventListener('submit', function(e) {
                e.preventDefault();

                // Clear previous errors
                document.querySelectorAll('.error').forEach(el => el.style.display = 'none');
                document.getElementById('amountError').style.display = 'none';
                document.getElementById('addressError').style.display = 'none';
                document.getElementById('confirmError').style.display = 'none';

                // Get form values
                const txType = document.getElementById('txType').value;
                const amount = parseFloat(document.getElementById('txAmount').value);
                const address = document.getElementById('recipientAddress').value.trim();
                const confirmed = document.getElementById('confirmTx').checked;

                let isValid = true;

                // Validate amount
                if (!amount || amount <= 0 || amount > 100) {
                    document.getElementById('amountError').textContent = 'Amount must be between 0.00000001 and 100 BTC';
                    document.getElementById('amountError').style.display = 'block';
                    isValid = false;
                }

                // Validate address
                if (!address) {
                    document.getElementById('addressError').textContent = 'Please enter a recipient address';
                    document.getElementById('addressError').style.display = 'block';
                    isValid = false;
                }

                // Validate confirmation
                if (!confirmed) {
                    document.getElementById('confirmError').style.display = 'block';
                    isValid = false;
                }

                if (!isValid) return;

                // Process transaction
                const submitBtn = document.getElementById('submitTxBtn');
                const originalText = submitBtn.textContent;
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
                submitBtn.disabled = true;

                // Simulate processing
                setTimeout(() => {
                    const txId = txType === 'deposit' ? 'DEP-' + Math.floor(Math.random() * 10000) : 'WD-' + Math.floor(Math.random() * 10000);

                    // Show success modal
                    showTransactionSuccessModal(txId, txType, amount, address);
                    modal.remove();

                    // Refresh data
                    fetchTransactionData();
                }, 2000);
            });

            // Close modal when clicking outside
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // Show transaction success modal
        function showTransactionSuccessModal(txId, txType, amount, address) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.8); display: flex; align-items: center;
                justify-content: center; z-index: 1000;
            `;
            modal.innerHTML = `
                <div style="background: var(--darker); padding: 30px; border-radius: 16px; max-width: 400px; width: 90%; text-align: center;">
                    <div style="color: var(--secondary); font-size: 3rem; margin-bottom: 20px;">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <h3 style="color: var(--primary); margin-bottom: 15px;">Transaction Created!</h3>
                    <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <div style="margin-bottom: 10px;"><strong>Transaction ID:</strong> ${txId}</div>
                        <div style="margin-bottom: 10px;"><strong>Type:</strong> ${txType.charAt(0).toUpperCase() + txType.slice(1)}</div>
                        <div style="margin-bottom: 10px;"><strong>Amount:</strong> ${amount} BTC</div>
                        <div><strong>Address:</strong> ${address.substring(0, 20)}...</div>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" style="background: var(--primary); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer;">Close</button>
                </div>
            `;
            document.body.appendChild(modal);

            // Close modal when clicking outside
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // Show operator details modal
        function showOperatorDetails(operatorId) {
            const operators = {
                1: {
                    name: 'Operator 01',
                    location: 'Munich, Germany',
                    bond: '2.5 BTC',
                    status: 'online',
                    uptime: '99.9%',
                    version: 'v2.1.4',
                    publicKey: '0x047c3a8e2f8b9c1d5e6f7a8b9c0d1e2f3a4b5c6d7e8f9a0b1c2d3e4f5a6b7c8d9e0f1a2b3c4d5e6f7a8b9c0d1e2f3a4b5c6d7e8f9a0b1',
                    lastSeen: '2 minutes ago',
                    blocksProcessed: '1,247',
                    transactionsSigned: '892'
                },
                2: {
                    name: 'Operator 02',
                    location: 'Tokyo, Japan',
                    bond: '2.0 BTC',
                    status: 'online',
                    uptime: '99.7%',
                    version: 'v2.1.4',
                    publicKey: '0x058d4b9e3f7c2a8d1e6f5b9c0d3e2f1a4b5c6d7e8f9a0b1c2d3e4f5a6b7c8d9e0f1a2b3c4d5e6f7a8b9c0d1e2f3a4b5c6d7e8f9a0b1',
                    lastSeen: '1 minute ago',
                    blocksProcessed: '1,189',
                    transactionsSigned: '756'
                },
                3: {
                    name: 'Operator 03',
                    location: 'Virginia, USA',
                    bond: '1.8 BTC',
                    status: 'offline',
                    uptime: '95.2%',
                    version: 'v2.1.3',
                    publicKey: '0x069e5c4f8a3b7d2e9f6c1a5b8d0e4f3c6b7a8d9e0f1a2b3c4d5e6f7a8b9c0d1e2f3a4b5c6d7e8f9a0b1c2d3e4f5a6b7c8d9e0f1a2',
                    lastSeen: '45 minutes ago',
                    blocksProcessed: '987',
                    transactionsSigned: '623'
                },
                4: {
                    name: 'Operator 04',
                    location: 'Singapore',
                    bond: '2.2 BTC',
                    status: 'syncing',
                    uptime: '98.5%',
                    version: 'v2.1.4',
                    publicKey: '0x071f6d5g9b4c8e3f0a7d2b6c9e1f4a5b8c0d3e6f7a9b1c4d5e8f9a2b3c6d7e0f1a4b5c8d9e2f3a6b7c0d1e4f5a8b9c2d3e6f7a0b1',
                    lastSeen: '5 minutes ago',
                    blocksProcessed: '1,056',
                    transactionsSigned: '689'
                }
            };

            const operator = operators[operatorId];
            if (!operator) return;

            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.8); display: flex; align-items: center;
                justify-content: center; z-index: 1000;
            `;

            const statusColor = operator.status === 'online' ? 'var(--secondary)' :
                               operator.status === 'offline' ? 'var(--danger)' : 'var(--warning)';
            const statusIcon = operator.status === 'online' ? 'fa-check-circle' :
                              operator.status === 'offline' ? 'fa-times-circle' : 'fa-sync fa-spin';

            modal.innerHTML = `
                <div style="background: var(--darker); padding: 30px; border-radius: 16px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto;">
                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 25px;">
                        <div style="width: 60px; height: 60px; border-radius: 50%; background: var(--gradient); display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem; font-weight: 600;">
                            ${operator.name.split(' ')[1]}
                        </div>
                        <div>
                            <h2 style="color: var(--primary); margin: 0; font-size: 1.5rem;">${operator.name}</h2>
                            <div style="color: var(--gray); margin-top: 5px;">${operator.location}</div>
                        </div>
                        <div style="margin-left: auto; text-align: center;">
                            <div style="color: ${statusColor}; font-size: 1.5rem;"><i class="fas ${statusIcon}"></i></div>
                            <div style="color: var(--gray); font-size: 0.8rem; text-transform: capitalize;">${operator.status}</div>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 25px;">
                        <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px;">
                            <div style="color: var(--gray); font-size: 0.9rem;">Bond Amount</div>
                            <div style="color: var(--light); font-size: 1.2rem; font-weight: 600;">${operator.bond}</div>
                        </div>
                        <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px;">
                            <div style="color: var(--gray); font-size: 0.9rem;">Uptime</div>
                            <div style="color: var(--light); font-size: 1.2rem; font-weight: 600;">${operator.uptime}</div>
                        </div>
                        <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px;">
                            <div style="color: var(--gray); font-size: 0.9rem;">Version</div>
                            <div style="color: var(--light); font-size: 1.2rem; font-weight: 600;">${operator.version}</div>
                        </div>
                        <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px;">
                            <div style="color: var(--gray); font-size: 0.9rem;">Last Seen</div>
                            <div style="color: var(--light); font-size: 1.2rem; font-weight: 600;">${operator.lastSeen}</div>
                        </div>
                    </div>

                    <div style="margin-bottom: 25px;">
                        <h3 style="color: var(--light); margin-bottom: 15px;">Performance Metrics</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                            <div style="background: rgba(255,255,255,0.05); padding: 12px; border-radius: 8px; text-align: center;">
                                <div style="color: var(--gray); font-size: 0.8rem;">Blocks Processed</div>
                                <div style="color: var(--light); font-size: 1.1rem; font-weight: 600;">${operator.blocksProcessed}</div>
                            </div>
                            <div style="background: rgba(255,255,255,0.05); padding: 12px; border-radius: 8px; text-align: center;">
                                <div style="color: var(--gray); font-size: 0.8rem;">Transactions Signed</div>
                                <div style="color: var(--light); font-size: 1.1rem; font-weight: 600;">${operator.transactionsSigned}</div>
                            </div>
                        </div>
                    </div>

                    <div style="margin-bottom: 25px;">
                        <h3 style="color: var(--light); margin-bottom: 15px;">Public Key</h3>
                        <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; font-family: monospace; font-size: 0.9rem; word-break: break-all; color: var(--light);">
                            ${operator.publicKey}
                        </div>
                    </div>

                    <div style="display: flex; gap: 10px; justify-content: flex-end;">
                        ${operator.status === 'offline' ?
                            '<button onclick="restartOperator(' + operatorId + ')" style="background: var(--warning); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer;"><i class="fas fa-play"></i> Restart Node</button>' :
                            '<button onclick="pingOperator(' + operatorId + ')" style="background: var(--info); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer;"><i class="fas fa-signal"></i> Ping Node</button>'
                        }
                        <button onclick="this.parentElement.parentElement.remove()" style="background: rgba(255,255,255,0.1); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer;">Close</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);

            // Close modal when clicking outside
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // Restart operator node
        function restartOperator(operatorId) {
            alert(`Restarting Operator ${operatorId}... (This would trigger a restart in a real system)`);
        }

        // Ping operator node
        function pingOperator(operatorId) {
            alert(`Pinging Operator ${operatorId}... Response time: ${Math.floor(Math.random() * 100) + 10}ms`);
        }

        // Notification system
        let notifications = [];
        let unreadCount = 0;

        // Toggle notification panel
        function toggleNotifications() {
            const panel = document.getElementById('notificationPanel');
            const isVisible = panel.style.display === 'block';

            // Hide panel if clicking outside
            document.addEventListener('click', function hidePanel(e) {
                if (!e.target.closest('.notification-bell') && !e.target.closest('.notification-panel')) {
                    panel.style.display = 'none';
                    document.removeEventListener('click', hidePanel);
                }
            });

            panel.style.display = isVisible ? 'none' : 'block';
        }

        // Add notification
        function addNotification(title, message, type = 'info') {
            const notification = {
                id: Date.now(),
                title,
                message,
                type,
                timestamp: new Date(),
                read: false
            };

            notifications.unshift(notification);
            if (notifications.length > 50) {
                notifications = notifications.slice(0, 50); // Keep only last 50
            }

            unreadCount++;
            updateNotificationBadge();
            renderNotifications();

            // Auto-hide after 5 seconds for info notifications
            if (type === 'info') {
                setTimeout(() => {
                    markAsRead(notification.id);
                }, 5000);
            }
        }

        // Mark notification as read
        function markAsRead(notificationId) {
            const notification = notifications.find(n => n.id === notificationId);
            if (notification && !notification.read) {
                notification.read = true;
                unreadCount--;
                updateNotificationBadge();
                renderNotifications();
            }
        }

        // Clear all notifications
        function clearAllNotifications() {
            notifications = [];
            unreadCount = 0;
            updateNotificationBadge();
            renderNotifications();
        }

        // Update notification badge
        function updateNotificationBadge() {
            const badge = document.getElementById('notificationBadge');
            if (unreadCount > 0) {
                badge.textContent = unreadCount > 99 ? '99+' : unreadCount;
                badge.style.display = 'flex';
            } else {
                badge.style.display = 'none';
            }
        }

        // Render notifications
        function renderNotifications() {
            const list = document.getElementById('notificationList');

            if (notifications.length === 0) {
                list.innerHTML = '<div style="padding: 20px; text-align: center; color: var(--gray);">No notifications</div>';
                return;
            }

            list.innerHTML = notifications.map(notification => {
                const timeAgo = getTimeAgo(notification.timestamp);
                const unreadClass = notification.read ? '' : 'unread';
                const iconClass = getNotificationIcon(notification.type);

                return `
                    <div class="notification-item ${unreadClass}" onclick="markAsRead(${notification.id})">
                        <div class="notification-title">
                            <i class="${iconClass}" style="margin-right: 8px;"></i>
                            ${notification.title}
                        </div>
                        <div class="notification-message">${notification.message}</div>
                        <div class="notification-time">${timeAgo}</div>
                    </div>
                `;
            }).join('');
        }

        // Get notification icon based on type
        function getNotificationIcon(type) {
            switch (type) {
                case 'success': return 'fas fa-check-circle';
                case 'warning': return 'fas fa-exclamation-triangle';
                case 'error': return 'fas fa-exclamation-circle';
                case 'info':
                default: return 'fas fa-info-circle';
            }
        }

        // Get time ago string
        function getTimeAgo(timestamp) {
            const now = new Date();
            const diff = now - timestamp;
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            const days = Math.floor(diff / 86400000);

            if (minutes < 1) return 'Just now';
            if (minutes < 60) return `${minutes}m ago`;
            if (hours < 24) return `${hours}h ago`;
            return `${days}d ago`;
        }

        // Generate random notifications for demo
        function generateRandomNotifications() {
            const events = [
                { title: 'New Deposit', message: 'Deposit of 0.25 BTC received', type: 'success' },
                { title: 'Operator Status', message: 'Operator 03 is now offline', type: 'warning' },
                { title: 'System Alert', message: 'High memory usage detected', type: 'warning' },
                { title: 'Transaction Complete', message: 'Withdrawal WD-4521 completed', type: 'success' },
                { title: 'Bitcoin Reorg', message: 'Chain reorganization detected', type: 'info' },
                { title: 'API Rate Limit', message: 'API rate limit exceeded', type: 'error' }
            ];

            const randomEvent = events[Math.floor(Math.random() * events.length)];
            addNotification(randomEvent.title, randomEvent.message, randomEvent.type);
        }

        // Show settings modal
        function showSettingsModal() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.8); display: flex; align-items: center;
                justify-content: center; z-index: 1000;
            `;
            modal.innerHTML = `
                <div style="background: var(--darker); padding: 30px; border-radius: 16px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto;">
                    <h2 style="color: var(--primary); margin-bottom: 25px; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-cog"></i> Settings
                    </h2>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px;">
                        <!-- General Settings -->
                        <div>
                            <h3 style="color: var(--light); margin-bottom: 15px; font-size: 1rem;">General</h3>

                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 5px; color: var(--light); font-size: 0.9rem;">Theme</label>
                                <select id="themeSelect" style="width: 100%; padding: 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; color: white;">
                                    <option value="dark">Dark</option>
                                    <option value="light">Light</option>
                                </select>
                            </div>

                            <div style="margin-bottom: 15px;">
                                <label style="display: flex; align-items: center; gap: 8px; color: var(--light); font-size: 0.9rem; cursor: pointer;">
                                    <input type="checkbox" id="autoRefreshToggle" style="margin: 0;">
                                    Auto Refresh
                                </label>
                            </div>

                            <div style="margin-bottom: 15px;">
                                <label style="display: block; margin-bottom: 5px; color: var(--light); font-size: 0.9rem;">Refresh Interval (seconds)</label>
                                <input type="number" id="refreshInterval" min="10" max="300" style="width: 100%; padding: 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; color: white;">
                            </div>
                        </div>

                        <!-- Notifications -->
                        <div>
                            <h3 style="color: var(--light); margin-bottom: 15px; font-size: 1rem;">Notifications</h3>

                            <div style="margin-bottom: 15px;">
                                <label style="display: flex; align-items: center; gap: 8px; color: var(--light); font-size: 0.9rem; cursor: pointer;">
                                    <input type="checkbox" id="notificationsEnabled" style="margin: 0;">
                                    Enable Notifications
                                </label>
                            </div>

                            <div style="margin-bottom: 15px;">
                                <label style="display: flex; align-items: center; gap: 8px; color: var(--light); font-size: 0.9rem; cursor: pointer;">
                                    <input type="checkbox" id="notificationSound" style="margin: 0;">
                                    Sound Alerts
                                </label>
                            </div>

                            <div style="margin-bottom: 10px;">
                                <label style="display: block; margin-bottom: 8px; color: var(--light); font-size: 0.9rem;">Notification Types</label>
                                <div style="display: flex; flex-direction: column; gap: 5px;">
                                    <label style="display: flex; align-items: center; gap: 8px; color: var(--gray); font-size: 0.8rem; cursor: pointer;">
                                        <input type="checkbox" id="notifyDeposits" style="margin: 0;">
                                        Deposits
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 8px; color: var(--gray); font-size: 0.8rem; cursor: pointer;">
                                        <input type="checkbox" id="notifyWithdrawals" style="margin: 0;">
                                        Withdrawals
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 8px; color: var(--gray); font-size: 0.8rem; cursor: pointer;">
                                        <input type="checkbox" id="notifySystem" style="margin: 0;">
                                        System Alerts
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 8px; color: var(--gray); font-size: 0.8rem; cursor: pointer;">
                                        <input type="checkbox" id="notifyOperators" style="margin: 0;">
                                        Operator Status
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Display Settings -->
                        <div style="grid-column: span 2;">
                            <h3 style="color: var(--light); margin-bottom: 15px; font-size: 1rem;">Display</h3>

                            <div style="display: flex; gap: 20px;">
                                <label style="display: flex; align-items: center; gap: 8px; color: var(--light); font-size: 0.9rem; cursor: pointer;">
                                    <input type="checkbox" id="showCharts" style="margin: 0;">
                                    Show Charts by Default
                                </label>

                                <label style="display: flex; align-items: center; gap: 8px; color: var(--light); font-size: 0.9rem; cursor: pointer;">
                                    <input type="checkbox" id="compactView" style="margin: 0;">
                                    Compact View
                                </label>

                                <label style="display: flex; align-items: center; gap: 8px; color: var(--light); font-size: 0.9rem; cursor: pointer;">
                                    <input type="checkbox" id="animationsEnabled" style="margin: 0;">
                                    Enable Animations
                                </label>
                            </div>
                        </div>
                    </div>

                    <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 25px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1);">
                        <button onclick="resetSettings()" style="background: rgba(255,255,255,0.1); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer;">Reset to Defaults</button>
                        <button onclick="this.parentElement.parentElement.remove()" style="background: rgba(255,255,255,0.1); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer;">Cancel</button>
                        <button onclick="saveSettings(); this.parentElement.parentElement.remove()" style="background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer;">Save Settings</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);

            // Load current settings into form
            loadSettingsIntoForm();

            // Close modal when clicking outside
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // Load settings into form
        function loadSettingsIntoForm() {
            document.getElementById('themeSelect').value = userSettings.theme;
            document.getElementById('autoRefreshToggle').checked = userSettings.autoRefresh;
            document.getElementById('refreshInterval').value = userSettings.refreshInterval;
            document.getElementById('notificationsEnabled').checked = userSettings.notifications.enabled;
            document.getElementById('notificationSound').checked = userSettings.notifications.sound;
            document.getElementById('notifyDeposits').checked = userSettings.notifications.types.deposits;
            document.getElementById('notifyWithdrawals').checked = userSettings.notifications.types.withdrawals;
            document.getElementById('notifySystem').checked = userSettings.notifications.types.system;
            document.getElementById('notifyOperators').checked = userSettings.notifications.types.operators;
            document.getElementById('showCharts').checked = userSettings.display.showCharts;
            document.getElementById('compactView').checked = userSettings.display.compactView;
            document.getElementById('animationsEnabled').checked = userSettings.display.animations;
        }

        // Save settings
        function saveSettings() {
            userSettings.theme = document.getElementById('themeSelect').value;
            userSettings.autoRefresh = document.getElementById('autoRefreshToggle').checked;
            userSettings.refreshInterval = parseInt(document.getElementById('refreshInterval').value);
            userSettings.notifications.enabled = document.getElementById('notificationsEnabled').checked;
            userSettings.notifications.sound = document.getElementById('notificationSound').checked;
            userSettings.notifications.types.deposits = document.getElementById('notifyDeposits').checked;
            userSettings.notifications.types.withdrawals = document.getElementById('notifyWithdrawals').checked;
            userSettings.notifications.types.system = document.getElementById('notifySystem').checked;
            userSettings.notifications.types.operators = document.getElementById('notifyOperators').checked;
            userSettings.display.showCharts = document.getElementById('showCharts').checked;
            userSettings.display.compactView = document.getElementById('compactView').checked;
            userSettings.display.animations = document.getElementById('animationsEnabled').checked;

            // Save to localStorage
            localStorage.setItem('userSettings', JSON.stringify(userSettings));

            // Apply settings
            applySettings();

            addNotification('Settings Saved', 'Your preferences have been updated', 'success');
        }

        // Apply settings to the UI
        function applySettings() {
            // Apply theme
            if (userSettings.theme === 'light') {
                document.documentElement.style.setProperty('--darker', '#f8fafc');
                document.documentElement.style.setProperty('--dark', '#e2e8f0');
                document.documentElement.style.setProperty('--light', '#1e293b');
                document.documentElement.style.setProperty('--gray', '#64748b');
            } else {
                // Reset to dark theme
                document.documentElement.style.setProperty('--darker', '#0a0f1c');
                document.documentElement.style.setProperty('--dark', '#0f172a');
                document.documentElement.style.setProperty('--light', '#f9fafb');
                document.documentElement.style.setProperty('--gray', '#94a3b8');
            }

            // Apply chart visibility
            const chartsSection = document.getElementById('chartsSection');
            if (chartsSection) {
                chartsSection.style.display = userSettings.display.showCharts ? 'block' : 'none';
                const toggleText = document.getElementById('chartToggleText');
                if (toggleText) {
                    toggleText.textContent = userSettings.display.showCharts ? 'Hide Charts' : 'Show Charts';
                }
            }

            // Apply animations
            document.documentElement.style.setProperty('--transition', userSettings.display.animations ? 'all 0.3s ease' : 'none');
        }

        // Reset settings to defaults
        function resetSettings() {
            userSettings = {
                theme: 'dark',
                autoRefresh: true,
                refreshInterval: 30,
                notifications: {
                    enabled: true,
                    sound: false,
                    types: {
                        deposits: true,
                        withdrawals: true,
                        system: true,
                        operators: true
                    }
                },
                display: {
                    showCharts: false,
                    compactView: false,
                    animations: true
                }
            };

            localStorage.setItem('userSettings', JSON.stringify(userSettings));
            loadSettingsIntoForm();
            applySettings();
            addNotification('Settings Reset', 'All settings have been reset to defaults', 'info');
        }

        // Show logs modal
        function showLogsModal() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.8); display: flex; align-items: center;
                justify-content: center; z-index: 1000;
            `;
            modal.innerHTML = `
                <div style="background: var(--darker); padding: 30px; border-radius: 16px; max-width: 700px; width: 90%; max-height: 80vh; overflow-y: auto;">
                    <h3 style="color: var(--primary); margin-bottom: 20px;">System Logs</h3>
                    <pre style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 8px; font-size: 0.9rem; white-space: pre-wrap; color: var(--light);">
2024-01-15 14:30:15 - Relayer system started
2024-01-15 14:30:16 - Connected to Bitcoin network
2024-01-15 14:30:17 - Connected to Starknet network
2024-01-15 14:30:18 - Operator nodes: 5/7 online
2024-01-15 14:30:20 - Bitcoin height: 788,543
2024-01-15 14:30:25 - Starknet height: 788,412
2024-01-15 14:31:00 - New deposit request: DEP-7832 (0.25 BTC)
2024-01-15 14:31:05 - SPV proof generated for tx abc123
2024-01-15 14:31:10 - Proof submitted to Starknet
2024-01-15 14:31:15 - Deposit completed successfully
2024-01-15 14:32:00 - New withdrawal request: WD-4521 (0.35 BTC)
2024-01-15 14:32:05 - Multi-sig signing initiated
2024-01-15 14:32:10 - 3/5 signatures collected
2024-01-15 14:32:15 - Withdrawal broadcast to Bitcoin network
2024-01-15 14:32:20 - Withdrawal completed
2024-01-15 14:33:00 - System health check passed
2024-01-15 14:33:05 - Memory usage: 64%
2024-01-15 14:33:10 - CPU usage: 42%
2024-01-15 14:33:15 - Disk usage: 78%
                    </pre>
                    <button onclick="this.parentElement.parentElement.remove()" style="background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; margin-top: 20px;">Close</button>
                </div>
            `;
            document.body.appendChild(modal);

            // Close modal when clicking outside
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // Export transaction data
        function exportTransactionData() {
            const data = {
                timestamp: new Date().toISOString(),
                deposits: [],
                withdrawals: []
            };

            // Collect deposit data
            const depositRows = document.querySelectorAll('.table tbody tr');
            depositRows.forEach(row => {
                const cells = row.querySelectorAll('td');
                if (cells.length >= 4) {
                    data.deposits.push({
                        id: cells[0].textContent,
                        amount: cells[1].textContent,
                        status: cells[2].textContent.trim(),
                        time: cells[3].textContent
                    });
                }
            });

            // Collect withdrawal data
            const withdrawalRows = document.querySelectorAll('.table tbody')[1]?.querySelectorAll('tr');
            if (withdrawalRows) {
                withdrawalRows.forEach(row => {
                    const cells = row.querySelectorAll('td');
                    if (cells.length >= 3) {
                        data.withdrawals.push({
                            id: cells[0].textContent,
                            amount: cells[1].textContent,
                            status: cells[2].textContent.trim()
                        });
                    }
                });
            }

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'bridge-transactions-export.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Show add node modal
        function showAddNodeModal() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.8); display: flex; align-items: center;
                justify-content: center; z-index: 1000;
            `;
            modal.innerHTML = `
                <div style="background: var(--darker); padding: 30px; border-radius: 16px; max-width: 500px; width: 90%;">
                    <h3 style="color: var(--primary); margin-bottom: 20px;">Add Operator Node</h3>
                    <form id="addNodeForm">
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; color: var(--light);">Node Name</label>
                            <input type="text" placeholder="Operator 05" style="width: 100%; padding: 10px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: white;">
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; color: var(--light);">Location</label>
                            <input type="text" placeholder="New York, USA" style="width: 100%; padding: 10px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: white;">
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; color: var(--light);">Bond Amount (BTC)</label>
                            <input type="number" step="0.1" placeholder="2.0" style="width: 100%; padding: 10px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: white;">
                        </div>
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 5px; color: var(--light);">Public Key</label>
                            <input type="text" placeholder="0x..." style="width: 100%; padding: 10px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: white;">
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button type="submit" style="flex: 1; background: var(--primary); color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer;">Add Node</button>
                            <button type="button" onclick="this.parentElement.parentElement.remove()" style="background: rgba(255,255,255,0.1); color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer;">Cancel</button>
                        </div>
                    </form>
                </div>
            `;
            document.body.appendChild(modal);

            // Handle form submission
            document.getElementById('addNodeForm').addEventListener('submit', function(e) {
                e.preventDefault();
                alert('Operator node added successfully! (This is a simulation)');
                modal.remove();
            });

            // Close modal when clicking outside
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // Generate API key
        function generateApiKey() {
            const apiKey = 'sk_' + Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);
            alert(`New API Key Generated:\n\n${apiKey}\n\nKeep this key secure!`);
        }

        // Show all withdrawals modal
        function showAllWithdrawalsModal() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.8); display: flex; align-items: center;
                justify-content: center; z-index: 1000;
            `;
            modal.innerHTML = `
                <div style="background: var(--darker); padding: 30px; border-radius: 16px; max-width: 800px; width: 90%; max-height: 80vh; overflow-y: auto;">
                    <h3 style="color: var(--primary); margin-bottom: 20px;">All Withdrawal Requests</h3>
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                                <th style="text-align: left; padding: 10px; color: var(--gray);">ID</th>
                                <th style="text-align: left; padding: 10px; color: var(--gray);">Amount</th>
                                <th style="text-align: left; padding: 10px; color: var(--gray);">Status</th>
                                <th style="text-align: left; padding: 10px; color: var(--gray);">Time</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr style="border-bottom: 1px solid rgba(255,255,255,0.05);">
                                <td style="padding: 10px;">WD-4521</td>
                                <td style="padding: 10px;">0.35 BTC</td>
                                <td style="padding: 10px;"><span class="status-badge status-processing"><i class="fas fa-spinner fa-spin"></i> Signing</span></td>
                                <td style="padding: 10px;">2 hours ago</td>
                            </tr>
                            <tr style="border-bottom: 1px solid rgba(255,255,255,0.05);">
                                <td style="padding: 10px;">WD-4520</td>
                                <td style="padding: 10px;">1.20 BTC</td>
                                <td style="padding: 10px;"><span class="status-badge status-pending"><i class="fas fa-clock"></i> Awaiting Signatures</span></td>
                                <td style="padding: 10px;">4 hours ago</td>
                            </tr>
                            <tr style="border-bottom: 1px solid rgba(255,255,255,0.05);">
                                <td style="padding: 10px;">WD-4519</td>
                                <td style="padding: 10px;">0.75 BTC</td>
                                <td style="padding: 10px;"><span class="status-badge status-completed"><i class="fas fa-check-circle"></i> Completed</span></td>
                                <td style="padding: 10px;">6 hours ago</td>
                            </tr>
                        </tbody>
                    </table>
                    <button onclick="this.parentElement.parentElement.remove()" style="background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; margin-top: 20px;">Close</button>
                </div>
            `;
            document.body.appendChild(modal);

            // Close modal when clicking outside
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // Test API endpoint
        async function testEndpoint(endpoint) {
            const responseDiv = document.getElementById(`response_${endpoint}`);
            const testButton = event.target.closest('button');

            if (!responseDiv) return;

            // Show loading state
            const originalText = testButton.innerHTML;
            testButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Testing...';
            testButton.disabled = true;
            testButton.classList.add('loading');

            // Clear previous response
            responseDiv.style.display = 'none';
            responseDiv.innerHTML = '';

            try {
                let response, status, data;

                switch (endpoint) {
                    case 'deposit_notify':
                        // Simulate POST request
                        await new Promise(resolve => setTimeout(resolve, 1000));
                        status = 200;
                        data = {
                            success: true,
                            deposit_id: "dep_" + Math.random().toString(36).substring(2, 8),
                            status: "received",
                            message: "Deposit notification received successfully"
                        };
                        break;

                    case 'deposit_status':
                        // Simulate GET request
                        await new Promise(resolve => setTimeout(resolve, 800));
                        status = 200;
                        data = {
                            deposit_id: "DEP-7832",
                            status: "completed",
                            amount: "0.25 BTC",
                            confirmations: 6,
                            created_at: new Date().toISOString(),
                            completed_at: new Date(Date.now() - 3600000).toISOString()
                        };
                        break;

                    default:
                        throw new Error('Unknown endpoint');
                }

                // Display response
                responseDiv.innerHTML = `
                    <div class="response-header">
                        <span style="color: var(--secondary);"><i class="fas fa-check-circle"></i> Response (${status})</span>
                        <button onclick="this.parentElement.parentElement.style.display='none'" style="background: none; border: none; color: var(--gray); cursor: pointer; font-size: 0.8rem;">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <pre style="color: var(--light); margin: 0; white-space: pre-wrap;">${JSON.stringify(data, null, 2)}</pre>
                `;
                responseDiv.className = 'api-response success';
                responseDiv.style.display = 'block';

            } catch (error) {
                // Display error
                responseDiv.innerHTML = `
                    <div class="response-header">
                        <span style="color: var(--danger);"><i class="fas fa-exclamation-triangle"></i> Error</span>
                        <button onclick="this.parentElement.parentElement.style.display='none'" style="background: none; border: none; color: var(--gray); cursor: pointer; font-size: 0.8rem;">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <pre style="color: var(--danger); margin: 0;">${error.message}</pre>
                `;
                responseDiv.className = 'api-response error';
                responseDiv.style.display = 'block';
            }

            // Reset button
            testButton.innerHTML = originalText;
            testButton.disabled = false;
            testButton.classList.remove('loading');
        }

         // Mark notification as read
        function markAsRead(id) {
            const notification = notifications.find(n => n.id === id);
            if (notification && !notification.read) {
                notification.read = true;
                renderNotifications();
                updateBadge();
            }
        }

        // Update notification badge
        function updateBadge() {
            const badge = document.getElementById('notificationBadge');
            const unreadCount = notifications.filter(n => !n.read).length;
            if (unreadCount > 0) {
                badge.textContent = unreadCount;
                badge.style.display = 'inline-block';
            } else {
                badge.style.display = 'none';
            }
        }

        // Show all activity modal
        function showAllActivity() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.8); display: flex; align-items: center;
                justify-content: center; z-index: 1000;
            `;
            modal.innerHTML = `
                <div style="background: var(--darker); padding: 30px; border-radius: 16px; max-width: 800px; width: 90%; max-height: 80vh; overflow-y: auto;">
                    <h3 style="color: var(--primary); margin-bottom: 20px;">All Activity</h3>
                    <div class="timeline">
                        <div class="timeline-item">
                            <div class="timeline-time">2 minutes ago</div>
                            <div class="timeline-content">New deposit request received: DEP-7832 (0.25 BTC)</div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-time">15 minutes ago</div>
                            <div class="timeline-content">SPV proof generated for transaction abc123</div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-time">45 minutes ago</div>
                            <div class="timeline-content">Operator 03 went offline. Investigating connectivity issues.</div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-time">1 hour ago</div>
                            <div class="timeline-content">Bitcoin chain reorganization detected at height 788,541</div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-time">2 hours ago</div>
                            <div class="timeline-content">System maintenance completed successfully</div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-time">3 hours ago</div>
                            <div class="timeline-content">New operator node added: Operator 05</div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-time">4 hours ago</div>
                            <div class="timeline-content">API rate limit increased for user account</div>
                        </div>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" style="background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; margin-top: 20px;">Close</button>
                </div>
            `;
            document.body.appendChild(modal);

            // Close modal when clicking outside
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }
    </script>
</body>
</html>       


